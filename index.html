<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitTrack Pro - Il tuo tracker fitness definitivo</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 50%, #1e293b 75%, #0f172a 100%);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
            min-height: 100vh;
            overscroll-behavior: none;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .glass-effect {
            backdrop-filter: blur(16px);
            background: rgba(15, 23, 42, 0.85);
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .smooth-transition {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
        }

        .hover-lift:hover {
            transform: translateY(-2px);
        }

        .card-hover {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            will-change: transform;
        }

        .card-hover:hover {
            transform: translateY(-3px);
            box-shadow: 0 16px 24px -5px rgba(0, 0, 0, 0.25);
        }

        .text-gradient {
            background: linear-gradient(135deg, #60a5fa 0%, #a855f7 50%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .progress-bar {
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
            background-size: 200% 100%;
            animation: progressShimmer 3s ease-in-out infinite;
        }

        @keyframes progressShimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            transform: translateX(400px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .notification.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .notification.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(59, 130, 246, 0.3);
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .view {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chart-container {
            position: relative;
            height: 300px;
            contain: layout;
        }

        @media (max-width: 768px) {
            .nav-text {
                display: none;
            }
            .card-hover:hover {
                transform: translateY(-2px);
            }
        }

        /* Optimized scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(148, 163, 184, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            border-radius: 10px;
        }

        /* Performance optimizations */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .animate-on-scroll.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Input focus optimizations */
        input:focus,
        select:focus,
        button:focus {
            outline: none;
            ring-offset: 0;
        }

        /* GPU acceleration for better performance */
        .gpu-accelerated {
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        /* Reduced motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="gpu-accelerated">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-gradient-to-br from-slate-900 via-blue-900 to-purple-900 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="mb-8">
                <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center shadow-2xl">
                    <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M2 12h2v-1h1v-1h1v-1h1V7H6V6H5V5H4v1H3v1H2v1H1v1h1v2zm20 0h-2v-1h-1v-1h-1v-1h-1V7h1V6h1V5h1v1h1v1h1v1h1v1h-1v2zm-8-4h-4v8h4V8z"/>
                    </svg>
                </div>
                <h1 class="text-4xl font-bold text-gradient mb-4">FitTrack Pro</h1>
                <div class="loading-spinner mx-auto"></div>
                <p class="text-gray-300 text-sm mt-4">Caricamento in corso...</p>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="glass-effect text-white p-4 border-b border-slate-700/50 backdrop-blur-lg shadow-2xl sticky top-0 z-40 gpu-accelerated">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-3">
                    <div class="p-3 bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl shadow-xl">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M2 12h2v-1h1v-1h1v-1h1V7H6V6H5V5H4v1H3v1H2v1H1v1h1v2zm20 0h-2v-1h-1v-1h-1v-1h-1V7h1V6h1V5h1v1h1v1h1v1h1v1h-1v2zm-8-4h-4v8h4V8z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gradient">FitTrack Pro</h1>
                        <p class="text-gray-400 text-xs font-medium">Il tuo tracker fitness definitivo</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-3">
                    <button id="importBtn" class="flex items-center space-x-2 px-3 py-2 text-sm bg-transparent border border-green-500 text-green-400 hover:bg-green-500 hover:text-white rounded-xl smooth-transition">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 4.414V15a1 1 0 11-2 0V4.414L7.707 5.707a1 1 0 01-1.414 0z"/>
                        </svg>
                        <span class="hidden sm:inline">Importa</span>
                    </button>
                    <button id="exportBtn" class="flex items-center space-x-2 px-3 py-2 text-sm bg-transparent border border-blue-500 text-blue-400 hover:bg-blue-500 hover:text-white rounded-xl smooth-transition">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"/>
                        </svg>
                        <span class="hidden sm:inline">Esporta</span>
                    </button>
                </div>
            </div>
            
            <div class="flex justify-center">
                <div class="flex space-x-1 glass-effect rounded-2xl p-2 border border-slate-700/30">
                    <button data-view="dashboard" class="nav-btn flex items-center space-x-2 px-4 py-3 rounded-xl text-sm font-semibold smooth-transition bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                        </svg>
                        <span class="nav-text">Dashboard</span>
                    </button>
                    <button data-view="exercises" class="nav-btn flex items-center space-x-2 px-4 py-3 rounded-xl text-sm font-semibold smooth-transition hover:bg-slate-700/50 text-gray-300 hover:text-white">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M2 12h2v-1h1v-1h1v-1h1V7H6V6H5V5H4v1H3v1H2v1H1v1h1v2zm20 0h-2v-1h-1v-1h-1v-1h-1V7h1V6h1V5h1v1h1v1h1v1h1v1h-1v2zm-8-4h-4v8h4V8z"/>
                        </svg>
                        <span class="nav-text">Esercizi</span>
                    </button>
                    <button data-view="progress" class="nav-btn flex items-center space-x-2 px-4 py-3 rounded-xl text-sm font-semibold smooth-transition hover:bg-slate-700/50 text-gray-300 hover:text-white">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                        </svg>
                        <span class="nav-text">Progressi</span>
                    </button>
                    <button data-view="measurements" class="nav-btn flex items-center space-x-2 px-4 py-3 rounded-xl text-sm font-semibold smooth-transition hover:bg-slate-700/50 text-gray-300 hover:text-white">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm2 2V5h1v1H5zM3 13a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1H4a1 1 0 01-1-1v-3zm2 2v-1h1v1H5z" clip-rule="evenodd"/>
                        </svg>
                        <span class="nav-text">Misure</span>
                    </button>
                    <button data-view="goals" class="nav-btn flex items-center space-x-2 px-4 py-3 rounded-xl text-sm font-semibold smooth-transition hover:bg-slate-700/50 text-gray-300 hover:text-white">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-14c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                        </svg>
                        <span class="nav-text">Obiettivi</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="mainContent" class="opacity-0 smooth-transition">
        
        <!-- Dashboard View -->
        <div id="dashboardView" class="view active p-4 md:p-6 space-y-6 max-w-7xl mx-auto">
            <div class="text-center space-y-2">
                <h2 class="text-4xl md:text-5xl font-bold text-gradient">Dashboard</h2>
                <p class="text-gray-400">Il tuo centro di controllo fitness</p>
            </div>
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6" id="statsCards">
                <!-- Cards will be generated by JS -->
            </div>

            <!-- Quick Actions -->
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/>
                    </svg>
                    Azioni Rapide
                </h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <button data-action="exercises" class="quick-action-btn flex flex-col items-center p-4 glass-effect rounded-xl hover:bg-slate-700/30 smooth-transition">
                        <svg class="w-8 h-8 text-blue-400 mb-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                        </svg>
                        <span class="text-white text-sm font-medium">Nuovo Esercizio</span>
                    </button>
                    <button data-action="measurements" class="quick-action-btn flex flex-col items-center p-4 glass-effect rounded-xl hover:bg-slate-700/30 smooth-transition">
                        <svg class="w-8 h-8 text-green-400 mb-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm2 2V5h1v1H5z" clip-rule="evenodd"/>
                        </svg>
                        <span class="text-white text-sm font-medium">Nuova Misura</span>
                    </button>
                    <button data-action="goals" class="quick-action-btn flex flex-col items-center p-4 glass-effect rounded-xl hover:bg-slate-700/30 smooth-transition">
                        <svg class="w-8 h-8 text-purple-400 mb-2" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-14c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                        </svg>
                        <span class="text-white text-sm font-medium">Nuovo Obiettivo</span>
                    </button>
                    <button data-action="export" class="quick-action-btn flex flex-col items-center p-4 glass-effect rounded-xl hover:bg-slate-700/30 smooth-transition">
                        <svg class="w-8 h-8 text-yellow-400 mb-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"/>
                        </svg>
                        <span class="text-white text-sm font-medium">Esporta Dati</span>
                    </button>
                </div>
            </div>

            <!-- Top Improvements -->
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-white flex items-center">
                        <svg class="w-6 h-6 mr-2 text-orange-400" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.28 2.67-.2 3.73-.72 1.59-2.73 2.99-4.01 5.11z"/>
                        </svg>
                        Miglioramenti (30gg)
                    </h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="topImprovements">
                    <!-- Content will be generated by JS -->
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                    </svg>
                    Attività Recente
                </h3>
                <div id="recentActivity" class="space-y-3">
                    <!-- Content will be generated by JS -->
                </div>
            </div>
        </div>

        <!-- Exercises View -->
        <div id="exercisesView" class="view p-4 md:p-6 space-y-6 max-w-7xl mx-auto">
            <div class="text-center space-y-2">
                <h2 class="text-4xl md:text-5xl font-bold text-gradient">Gestione Esercizi</h2>
                <p class="text-gray-400">Organizza e monitora i tuoi esercizi</p>
            </div>
            
            <!-- Add Exercise Form -->
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <div class="flex items-center mb-4">
                    <div class="p-3 bg-gradient-to-r from-green-600 to-green-700 rounded-xl mr-3 shadow-lg">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-white">Nuovo Esercizio</h3>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <input type="text" id="exerciseName" placeholder="Nome esercizio" class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-green-500 focus:outline-none smooth-transition placeholder-gray-400">
                    <select id="exerciseCategory" class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-green-500 focus:outline-none smooth-transition">
                        <option value="petto">Petto</option>
                        <option value="schiena">Schiena</option>
                        <option value="spalle">Spalle</option>
                        <option value="bicipiti">Bicipiti</option>
                        <option value="tricipiti">Tricipiti</option>
                        <option value="gambe">Gambe</option>
                        <option value="addominali">Addominali</option>
                        <option value="cardio">Cardio</option>
                    </select>
                    <input type="text" id="exerciseMuscleGroup" placeholder="Gruppo muscolare" class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-green-500 focus:outline-none smooth-transition placeholder-gray-400">
                </div>
                
                <button id="addExerciseBtn" class="flex items-center justify-center space-x-2 px-6 py-3 font-semibold rounded-xl smooth-transition hover-lift shadow-lg bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                    </svg>
                    <span>Aggiungi Esercizio</span>
                </button>
            </div>

            <!-- Search and Filter -->
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-white font-semibold flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                            </svg>
                            Cerca Esercizi
                        </label>
                        <input type="text" id="searchExercises" placeholder="Cerca per nome..." class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-blue-500 focus:outline-none smooth-transition placeholder-gray-400 w-full">
                    </div>
                    <div class="space-y-2">
                        <label class="text-white font-semibold flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd"/>
                            </svg>
                            Filtra per Categoria
                        </label>
                        <select id="filterCategory" class="w-full glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-blue-500 focus:outline-none smooth-transition">
                            <option value="all">Tutti</option>
                            <option value="petto">Petto</option>
                            <option value="schiena">Schiena</option>
                            <option value="spalle">Spalle</option>
                            <option value="bicipiti">Bicipiti</option>
                            <option value="tricipiti">Tricipiti</option>
                            <option value="gambe">Gambe</option>
                            <option value="addominali">Addominali</option>
                            <option value="cardio">Cardio</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Exercises Grid -->
            <div id="exercisesGrid" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                <!-- Content will be generated by JS -->
            </div>
        </div>

        <!-- Progress View -->
        <div id="progressView" class="view p-4 md:p-6 space-y-6 max-w-7xl mx-auto">
            <div class="text-center space-y-2">
                <h2 class="text-4xl md:text-5xl font-bold text-gradient">Progressi</h2>
                <p class="text-gray-400">Visualizza i tuoi miglioramenti nel tempo</p>
            </div>
            
            <!-- Exercise Progress Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="glass-effect rounded-2xl p-6 card-hover">
                    <h3 class="text-lg font-bold text-white mb-4">Progressione Peso Massimo</h3>
                    <div class="chart-container">
                        <canvas id="weightProgressChart"></canvas>
                    </div>
                </div>
                
                <div class="glass-effect rounded-2xl p-6 card-hover">
                    <h3 class="text-lg font-bold text-white mb-4">Volume di Allenamento</h3>
                    <div class="chart-container">
                        <canvas id="volumeProgressChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Exercise Selection -->
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <h3 class="text-lg font-bold text-white mb-4">Analisi Dettagliata Esercizio</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <select id="progressExerciseSelect" class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-blue-500 focus:outline-none smooth-transition">
                        <option value="">Seleziona un esercizio...</option>
                    </select>
                    <select id="progressTimeRange" class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-blue-500 focus:outline-none smooth-transition">
                        <option value="30">Ultimi 30 giorni</option>
                        <option value="60">Ultimi 60 giorni</option>
                        <option value="90">Ultimi 90 giorni</option>
                        <option value="all">Tutti i dati</option>
                    </select>
                </div>
                
                <div class="chart-container">
                    <canvas id="exerciseDetailChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Measurements View -->
        <div id="measurementsView" class="view p-4 md:p-6 space-y-6 max-w-7xl mx-auto">
            <div class="text-center space-y-2">
                <h2 class="text-4xl md:text-5xl font-bold text-gradient">Misure Corporee</h2>
                <p class="text-gray-400">Monitora i cambiamenti del tuo corpo</p>
            </div>
            
            <!-- Add Measurement Form -->
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <div class="flex items-center mb-4">
                    <div class="p-3 bg-gradient-to-r from-purple-600 to-purple-700 rounded-xl mr-3 shadow-lg">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-white">Nuova Misurazione</h3>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                    <select id="measurementType" class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-purple-500 focus:outline-none smooth-transition">
                        <option value="peso">Peso (kg)</option>
                        <option value="altezza">Altezza (cm)</option>
                        <option value="petto">Petto (cm)</option>
                        <option value="vita">Vita (cm)</option>
                        <option value="fianchi">Fianchi (cm)</option>
                        <option value="braccio_dx">Braccio Dx (cm)</option>
                        <option value="braccio_sx">Braccio Sx (cm)</option>
                        <option value="coscia_dx">Coscia Dx (cm)</option>
                        <option value="coscia_sx">Coscia Sx (cm)</option>
                        <option value="bf_percentage">Massa Grassa (%)</option>
                    </select>
                    <input type="number" id="measurementValue" placeholder="Valore" step="0.1" class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-purple-500 focus:outline-none smooth-transition placeholder-gray-400">
                    <input type="date" id="measurementDate" class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-purple-500 focus:outline-none smooth-transition">
                    <button id="addMeasurementBtn" class="flex items-center justify-center space-x-2 px-6 py-3 font-semibold rounded-xl smooth-transition hover-lift shadow-lg bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                        </svg>
                        <span>Aggiungi</span>
                    </button>
                </div>
            </div>
            
            <!-- Measurements Chart -->
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <h3 class="text-lg font-bold text-white mb-4">Andamento Misure</h3>
                <div class="mb-4">
                    <select id="measurementChartType" class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-purple-500 focus:outline-none smooth-transition">
                        <option value="">Seleziona tipo di misurazione...</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="measurementChart"></canvas>
                </div>
            </div>
            
            <!-- Measurements List -->
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <h3 class="text-lg font-bold text-white mb-4">Storico Misurazioni</h3>
                <div id="measurementsList" class="space-y-3">
                    <!-- Content will be generated by JS -->
                </div>
            </div>
        </div>

        <!-- Goals View -->
        <div id="goalsView" class="view p-4 md:p-6 space-y-6 max-w-7xl mx-auto">
            <div class="text-center space-y-2">
                <h2 class="text-4xl md:text-5xl font-bold text-gradient">Obiettivi</h2>
                <p class="text-gray-400">Definisci e raggiungi i tuoi traguardi</p>
            </div>
            
            <!-- Add Goal Form -->
            <div class="glass-effect rounded-2xl p-6 card-hover">
                <div class="flex items-center mb-4">
                    <div class="p-3 bg-gradient-to-r from-yellow-600 to-yellow-700 rounded-xl mr-3 shadow-lg">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-white">Nuovo Obiettivo</h3>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <input type="text" id="goalTarget" placeholder="Descrizione obiettivo (es. Panca Piana 100kg)" class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-yellow-500 focus:outline-none smooth-transition placeholder-gray-400">
                    <select id="goalType" class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-yellow-500 focus:outline-none smooth-transition">
                        <option value="weight">Peso Esercizio</option>
                        <option value="reps">Ripetizioni</option>
                        <option value="body_weight">Peso Corporeo</option>
                        <option value="body_measurement">Misurazione Corpo</option>
                        <option value="time">Tempo (min)</option>
                        <option value="distance">Distanza (km)</option>
                    </select>
                    <input type="number" id="goalValue" placeholder="Valore target" step="0.1" class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-yellow-500 focus:outline-none smooth-transition placeholder-gray-400">
                    <input type="date" id="goalDeadline" class="glass-effect text-white p-3 rounded-xl border border-slate-600/50 focus:border-yellow-500 focus:outline-none smooth-transition">
                </div>
                
                <button id="addGoalBtn" class="flex items-center justify-center space-x-2 px-6 py-3 font-semibold rounded-xl smooth-transition hover-lift shadow-lg bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 text-white">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                    </svg>
                    <span>Aggiungi Obiettivo</span>
                </button>
            </div>
            
            <!-- Goals List -->
            <div id="goalsList" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Content will be generated by JS -->
            </div>
        </div>

    </main>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center z-50 p-4 hidden">
        <div class="glass-effect rounded-2xl p-6 max-w-md w-full">
            <div class="text-center space-y-4">
                <div class="p-4 bg-red-500/20 rounded-full w-16 h-16 mx-auto flex items-center justify-center">
                    <svg class="w-8 h-8 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"/>
                        <path fill-rule="evenodd" d="M4 5a1 1 0 000 2v6a2 2 0 002 2h8a2 2 0 002-2V7a1 1 0 100-2H4z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <div class="space-y-2">
                    <h3 class="text-xl font-bold text-white">Conferma Eliminazione</h3>
                    <p class="text-gray-300">Sei sicuro di voler eliminare questo elemento? Questa azione non può essere annullata.</p>
                </div>
                <div class="flex space-x-3 pt-4">
                    <button id="cancelDeleteBtn" class="flex-1 px-4 py-3 font-semibold rounded-xl smooth-transition bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white border border-gray-600">
                        Annulla
                    </button>
                    <button id="confirmDeleteBtn" class="flex-1 px-4 py-3 font-semibold rounded-xl smooth-transition bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white shadow-lg">
                        Elimina
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- File Import Input (hidden) -->
    <input type="file" id="fileImport" accept=".json" style="display: none;">

    <script>
        class FitTracker {
            constructor() {
                this.exercises = [];
                this.workouts = [];
                this.bodyMeasurements = [];
                this.goals = [];
                this.currentView = 'dashboard';
                this.deleteTarget = null;
                this.charts = {};
                this.debounceTimers = {};
                
                this.init();
            }

            init() {
                this.loadData();
                this.setupEventListeners();
                this.showApp();
            }

            showApp() {
                requestAnimationFrame(() => {
                    setTimeout(() => {
                        const loadingScreen = document.getElementById('loadingScreen');
                        const mainContent = document.getElementById('mainContent');
                        
                        if (loadingScreen) {
                            loadingScreen.style.opacity = '0';
                            setTimeout(() => {
                                loadingScreen.style.display = 'none';
                                if (mainContent) {
                                    mainContent.style.opacity = '1';
                                    this.renderDashboard();
                                }
                            }, 300);
                        }
                    }, 300);
                });
            }

            loadData() {
                try {
                    const savedExercises = localStorage.getItem('fittrack_exercises');
                    const savedWorkouts = localStorage.getItem('fittrack_workouts');
                    const savedMeasurements = localStorage.getItem('fittrack_measurements');
                    const savedGoals = localStorage.getItem('fittrack_goals');

                    if (savedExercises && savedWorkouts) {
                        this.exercises = JSON.parse(savedExercises) || [];
                        this.workouts = JSON.parse(savedWorkouts) || [];
                        this.bodyMeasurements = JSON.parse(savedMeasurements || '[]') || [];
                        this.goals = JSON.parse(savedGoals || '[]') || [];
                    } else {
                        this.initializeSampleData();
                    }
                } catch (e) {
                    console.error('Error loading data:', e);
                    this.initializeSampleData();
                }
            }

            saveData() {
                try {
                    localStorage.setItem('fittrack_exercises', JSON.stringify(this.exercises));
                    localStorage.setItem('fittrack_workouts', JSON.stringify(this.workouts));
                    localStorage.setItem('fittrack_measurements', JSON.stringify(this.bodyMeasurements));
                    localStorage.setItem('fittrack_goals', JSON.stringify(this.goals));
                } catch (e) {
                    console.warn('Could not save to localStorage:', e);
                    this.showNotification('Errore nel salvataggio dei dati', 'error');
                }
            }

            initializeSampleData() {
                this.exercises = [
                    { id: 1, name: 'Panca Piana', category: 'petto', muscleGroup: 'Pettorale maggiore' },
                    { id: 2, name: 'Squat', category: 'gambe', muscleGroup: 'Quadricipiti' },
                    { id: 3, name: 'Deadlift', category: 'schiena', muscleGroup: 'Dorsali' },
                    { id: 4, name: 'Military Press', category: 'spalle', muscleGroup: 'Deltoidi' },
                    { id: 5, name: 'Curl Bilanciere', category: 'bicipiti', muscleGroup: 'Bicipiti' }
                ];

                this.workouts = [
                    { id: 1, exerciseId: 1, exercise: 'Panca Piana', weight: 80, sets: 3, reps: 8, date: '2025-08-15' },
                    { id: 2, exerciseId: 1, exercise: 'Panca Piana', weight: 82, sets: 3, reps: 8, date: '2025-08-18' },
                    { id: 3, exerciseId: 1, exercise: 'Panca Piana', weight: 85, sets: 3, reps: 7, date: '2025-08-22' },
                    { id: 4, exerciseId: 1, exercise: 'Panca Piana', weight: 87, sets: 3, reps: 7, date: '2025-08-25' },
                    { id: 5, exerciseId: 1, exercise: 'Panca Piana', weight: 90, sets: 3, reps: 6, date: '2025-08-27' },
                    { id: 6, exerciseId: 2, exercise: 'Squat', weight: 100, sets: 4, reps: 6, date: '2025-08-16' },
                    { id: 7, exerciseId: 2, exercise: 'Squat', weight: 105, sets: 4, reps: 6, date: '2025-08-20' },
                    { id: 8, exerciseId: 2, exercise: 'Squat', weight: 110, sets: 4, reps: 6, date: '2025-08-24' }
                ];

                this.bodyMeasurements = [
                    { id: 1, type: 'peso', value: 75, date: '2025-08-15' },
                    { id: 2, type: 'peso', value: 74.5, date: '2025-08-22' },
                    { id: 3, type: 'peso', value: 74, date: '2025-08-27' },
                    { id: 4, type: 'petto', value: 98, date: '2025-08-15' },
                    { id: 5, type: 'petto', value: 99, date: '2025-08-22' },
                    { id: 6, type: 'petto', value: 100, date: '2025-08-27' }
                ];

                this.goals = [
                    { id: 1, type: 'weight', target: 'Panca Piana 100kg', value: 100, current: 90, deadline: '2025-12-31' },
                    { id: 2, type: 'body_weight', target: 'Peso 70kg', value: 70, current: 74, deadline: '2025-11-30' },
                    { id: 3, type: 'weight', target: 'Squat 130kg', value: 130, current: 110, deadline: '2025-10-31' }
                ];

                this.saveData();
            }

            debounce(func, wait, key) {
                return (...args) => {
                    clearTimeout(this.debounceTimers[key]);
                    this.debounceTimers[key] = setTimeout(() => func.apply(this, args), wait);
                };
            }

            setupEventListeners() {
                // Event delegation for better performance
                document.addEventListener('click', this.handleGlobalClick.bind(this));
                document.addEventListener('input', this.handleGlobalInput.bind(this));
                document.addEventListener('change', this.handleGlobalChange.bind(this));

                // Set default dates
                const today = new Date().toISOString().split('T')[0];
                const measurementDate = document.getElementById('measurementDate');
                const goalDeadline = document.getElementById('goalDeadline');
                if (measurementDate) measurementDate.value = today;
                if (goalDeadline) goalDeadline.value = today;
            }

            handleGlobalClick(event) {
                const target = event.target;
                const closest = target.closest;

                // Navigation
                if (target.classList.contains('nav-btn') || target.closest('.nav-btn')) {
                    const btn = target.closest('.nav-btn');
                    const view = btn.dataset.view;
                    if (view) this.switchView(view);
                    return;
                }

                // Quick actions
                if (target.classList.contains('quick-action-btn') || target.closest('.quick-action-btn')) {
                    const btn = target.closest('.quick-action-btn');
                    const action = btn.dataset.action;
                    if (action) {
                        if (action === 'export') {
                            this.exportData();
                        } else {
                            this.switchView(action);
                        }
                    }
                    return;
                }

                // Form buttons
                if (target.id === 'addExerciseBtn') {
                    this.addExercise();
                } else if (target.id === 'addMeasurementBtn') {
                    this.addMeasurement();
                } else if (target.id === 'addGoalBtn') {
                    this.addGoal();
                } else if (target.id === 'exportBtn') {
                    this.exportData();
                } else if (target.id === 'importBtn') {
                    document.getElementById('fileImport').click();
                } else if (target.id === 'cancelDeleteBtn') {
                    document.getElementById('deleteModal').classList.add('hidden');
                } else if (target.id === 'confirmDeleteBtn') {
                    if (this.deleteTarget) {
                        const [type, id] = this.deleteTarget.split('-');
                        this.handleDelete(type, parseInt(id));
                        document.getElementById('deleteModal').classList.add('hidden');
                        this.deleteTarget = null;
                    }
                }

                // Delete buttons
                if (target.dataset.action === 'delete') {
                    const type = target.dataset.type;
                    const id = target.dataset.id;
                    this.showDeleteModal(type, id);
                }

                // Workout add buttons
                if (target.dataset.action === 'add-workout') {
                    const exerciseId = parseInt(target.dataset.exerciseId);
                    this.addWorkout(exerciseId);
                }
            }

            handleGlobalInput(event) {
                const target = event.target;

                // Debounced search
                if (target.id === 'searchExercises') {
                    this.debounce(() => this.renderExercises(), 300, 'search')();
                }
            }

            handleGlobalChange(event) {
                const target = event.target;

                // File import
                if (target.id === 'fileImport') {
                    this.importData(event);
                } else if (target.id === 'filterCategory') {
                    this.renderExercises();
                } else if (target.id === 'progressExerciseSelect' || target.id === 'progressTimeRange') {
                    this.renderExerciseDetailChart();
                } else if (target.id === 'measurementChartType') {
                    this.renderMeasurementChart();
                }
            }

            switchView(view) {
                // Update navigation with better performance
                const navButtons = document.querySelectorAll('.nav-btn');
                navButtons.forEach(btn => {
                    btn.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-purple-600', 'text-white', 'shadow-lg');
                    btn.classList.add('hover:bg-slate-700/50', 'text-gray-300', 'hover:text-white');
                });

                const activeBtn = document.querySelector(`[data-view="${view}"]`);
                if (activeBtn) {
                    activeBtn.classList.remove('hover:bg-slate-700/50', 'text-gray-300', 'hover:text-white');
                    activeBtn.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-purple-600', 'text-white', 'shadow-lg');
                }

                // Update content with smooth transition
                const views = document.querySelectorAll('.view');
                views.forEach(v => v.classList.remove('active'));
                
                requestAnimationFrame(() => {
                    const targetView = document.getElementById(view + 'View');
                    if (targetView) targetView.classList.add('active');

                    this.currentView = view;

                    // Render appropriate content with delay for smooth transition
                    setTimeout(() => {
                        switch(view) {
                            case 'dashboard':
                                this.renderDashboard();
                                break;
                            case 'exercises':
                                this.renderExercises();
                                break;
                            case 'progress':
                                this.renderProgress();
                                break;
                            case 'measurements':
                                this.renderMeasurements();
                                break;
                            case 'goals':
                                this.renderGoals();
                                break;
                        }
                    }, 100);
                });
            }

            renderDashboard() {
                this.renderStatsCards();
                this.renderTopImprovements();
                this.renderRecentActivity();
            }

            renderStatsCards() {
                try {
                    const completedGoals = this.goals.filter(g => this.calculateGoalProgress(g) >= 100).length;
                    
                    // Removed total workouts and monthly exercises stats as requested
                    const stats = [
                        { title: 'Esercizi Attivi', value: this.exercises.length, subtitle: 'Nel tuo repertorio', color: 'blue' },
                        { title: 'Obiettivi Raggiunti', value: completedGoals, subtitle: 'Traguardi completati', color: 'yellow' },
                        { title: 'Misurazioni', value: this.bodyMeasurements.length, subtitle: 'Registrazioni corpo', color: 'purple' }
                    ];

                    const colorClasses = {
                        blue: 'from-blue-600 to-blue-700',
                        green: 'from-green-600 to-green-700',
                        yellow: 'from-yellow-600 to-yellow-700',
                        purple: 'from-purple-600 to-purple-700'
                    };

                    const container = document.getElementById('statsCards');
                    if (container) {
                        container.innerHTML = stats.map((stat, index) => `
                            <div class="glass-effect rounded-2xl p-4 md:p-6 card-hover relative overflow-hidden animate-on-scroll" style="animation-delay: ${index * 100}ms">
                                <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-to-br from-${stat.color}-500/10 to-transparent rounded-full -mr-12 -mt-12"></div>
                                <div class="relative">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="p-3 bg-gradient-to-r ${colorClasses[stat.color]} rounded-xl shadow-lg">
                                            <svg class="w-5 h-5 md:w-6 md:h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M10 2l2 6h6l-5 4 2 6-5-4-5 4 2-6-5-4h6z"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <h3 class="text-gray-400 text-xs md:text-sm font-medium mb-1">${stat.title}</h3>
                                    <p class="text-2xl md:text-3xl font-bold text-white mb-1">${stat.value}</p>
                                    <p class="text-gray-500 text-xs">${stat.subtitle}</p>
                                </div>
                            </div>
                        `).join('');

                        // Trigger scroll animations
                        this.triggerScrollAnimations();
                    }
                } catch (error) {
                    console.error('Error rendering stats cards:', error);
                }
            }

            triggerScrollAnimations() {
                requestAnimationFrame(() => {
                    const elements = document.querySelectorAll('.animate-on-scroll');
                    elements.forEach(el => el.classList.add('visible'));
                });
            }

            renderTopImprovements() {
                try {
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    
                    const improvements = this.exercises.map(exercise => {
                        const exerciseWorkouts = this.workouts
                            .filter(w => w.exerciseId === exercise.id && new Date(w.date) >= thirtyDaysAgo)
                            .sort((a, b) => new Date(a.date) - new Date(b.date));
                            
                        if (exerciseWorkouts.length < 2) return null;
                        
                        const first = exerciseWorkouts[0];
                        const last = exerciseWorkouts[exerciseWorkouts.length - 1];
                        const improvement = last.weight - first.weight;
                        
                        return {
                            exercise: exercise.name,
                            improvement,
                            percentage: ((improvement / first.weight) * 100).toFixed(1),
                            from: first.weight,
                            to: last.weight
                        };
                    })
                    .filter(item => item && item.improvement > 0)
                    .sort((a, b) => b.improvement - a.improvement)
                    .slice(0, 3);

                    const container = document.getElementById('topImprovements');
                    if (!container) return;

                    if (improvements.length === 0) {
                        container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-8">Nessun miglioramento negli ultimi 30 giorni</p>';
                        return;
                    }

                    container.innerHTML = improvements.map((improvement, index) => `
                        <div class="relative bg-gradient-to-br from-orange-900/20 to-red-900/10 p-4 rounded-xl border border-orange-500/20 hover:border-orange-500/40 smooth-transition overflow-hidden group">
                            <div class="absolute -top-8 -right-8 w-16 h-16 bg-gradient-to-br from-orange-500/20 to-red-500/20 rounded-full"></div>
                            <div class="absolute top-2 right-2 text-orange-400 font-bold">#${index + 1}</div>
                            <div class="space-y-2 relative z-10">
                                <h4 class="text-white font-bold">${improvement.exercise}</h4>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-400">Progresso:</span>
                                    <span class="text-orange-400 font-bold">+${improvement.improvement}kg</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-400">Crescita:</span>
                                    <span class="text-green-400 font-bold">+${improvement.percentage}%</span>
                                </div>
                                <div class="pt-2 border-t border-gray-700">
                                    <div class="flex items-center justify-between text-xs text-gray-500">
                                        <span>${improvement.from}kg → ${improvement.to}kg</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Error rendering top improvements:', error);
                }
            }

            renderRecentActivity() {
                try {
                    const recentWorkouts = this.workouts
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 8); // Reduced from 10 to 8 for better performance

                    const container = document.getElementById('recentActivity');
                    if (!container) return;

                    if (recentWorkouts.length === 0) {
                        container.innerHTML = '<p class="text-gray-400 text-center py-4">Nessuna attività recente</p>';
                        return;
                    }

                    const fragment = document.createDocumentFragment();
                    recentWorkouts.forEach(workout => {
                        const div = document.createElement('div');
                        div.className = 'flex items-center justify-between p-4 glass-effect rounded-xl hover:bg-slate-700/30 smooth-transition';
                        div.innerHTML = `
                            <div class="flex items-center space-x-3">
                                <div class="p-2 bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg">
                                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M2 12h2v-1h1v-1h1v-1h1V7H6V6H5V5H4v1H3v1H2v1H1v1h1v2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="text-white font-semibold">${workout.exercise}</h4>
                                    <p class="text-gray-400 text-sm">${workout.sets} serie × ${workout.reps} reps</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-blue-400 font-bold">${workout.weight}kg</p>
                                <p class="text-gray-500 text-sm">${this.formatDate(workout.date)}</p>
                            </div>
                        `;
                        fragment.appendChild(div);
                    });

                    container.innerHTML = '';
                    container.appendChild(fragment);
                } catch (error) {
                    console.error('Error rendering recent activity:', error);
                }
            }

            renderExercises() {
                try {
                    const searchInput = document.getElementById('searchExercises');
                    const filterSelect = document.getElementById('filterCategory');
                    const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
                    const categoryFilter = filterSelect ? filterSelect.value : 'all';
                    
                    let filtered = [...this.exercises];
                    
                    if (categoryFilter !== 'all') {
                        filtered = filtered.filter(ex => ex.category === categoryFilter);
                    }
                    
                    if (searchTerm) {
                        filtered = filtered.filter(ex => 
                            ex.name.toLowerCase().includes(searchTerm) ||
                            (ex.muscleGroup && ex.muscleGroup.toLowerCase().includes(searchTerm))
                        );
                    }

                    const container = document.getElementById('exercisesGrid');
                    if (!container) return;
                    
                    if (filtered.length === 0) {
                        container.innerHTML = `
                            <div class="col-span-full glass-effect rounded-2xl p-8 card-hover text-center py-12">
                                <div class="space-y-4">
                                    <svg class="w-16 h-16 text-gray-400 mx-auto" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                                    </svg>
                                    <h3 class="text-xl font-semibold text-gray-300">Nessun esercizio trovato</h3>
                                    <p class="text-gray-500">
                                        ${searchTerm ? `Nessun risultato per "${searchTerm}"` : `Nessun esercizio nella categoria selezionata`}
                                    </p>
                                </div>
                            </div>
                        `;
                        return;
                    }

                    const fragment = document.createDocumentFragment();
                    filtered.forEach(exercise => {
                        const exerciseWorkouts = this.workouts.filter(w => w.exerciseId === exercise.id);
                        const maxWeight = exerciseWorkouts.length > 0 ? Math.max(...exerciseWorkouts.map(w => w.weight || 0)) : 0;
                        const latestWorkout = exerciseWorkouts.length > 0 ? 
                            exerciseWorkouts.sort((a, b) => new Date(b.date) - new Date(a.date))[0] : null;

                        const div = document.createElement('div');
                        div.className = 'glass-effect rounded-2xl p-6 card-hover relative group gpu-accelerated';
                        div.innerHTML = `
                            <div class="absolute -top-2 -right-2 px-3 py-1 rounded-full text-xs font-bold shadow-lg bg-gradient-to-r from-blue-500 to-purple-600 text-white">
                                ${exercise.category}
                            </div>

                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center">
                                    <div class="p-3 bg-gradient-to-r from-slate-700 to-slate-800 rounded-xl mr-3 shadow-lg">
                                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M2 12h2v-1h1v-1h1v-1h1V7H6V6H5V5H4v1H3v1H2v1H1v1h1v2z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="text-white font-bold text-lg">${exercise.name}</h4>
                                        <p class="text-gray-400 text-sm">${exercise.muscleGroup || 'Non specificato'}</p>
                                    </div>
                                </div>
                                
                                <button class="opacity-0 group-hover:opacity-100 smooth-transition p-2 text-sm font-semibold rounded-lg bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white shadow-lg hover-lift" data-action="delete" data-type="exercise" data-id="${exercise.id}">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"/>
                                        <path fill-rule="evenodd" d="M4 5a1 1 0 000 2v6a2 2 0 002 2h8a2 2 0 002-2V7a1 1 0 100-2H4z" clip-rule="evenodd"/>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="space-y-3 mb-4">
                                <div class="flex justify-between items-center p-3 glass-effect rounded-lg">
                                    <span class="text-gray-400 text-sm font-medium">Peso Massimo</span>
                                    <span class="text-blue-400 font-bold text-lg">${maxWeight}kg</span>
                                </div>
                                ${latestWorkout ? `
                                    <div class="flex justify-between items-center p-3 glass-effect rounded-lg">
                                        <span class="text-gray-400 text-sm font-medium">Ultimo Allenamento</span>
                                        <span class="text-green-400 font-semibold text-sm">${this.formatDate(latestWorkout.date)}</span>
                                    </div>
                                ` : ''}
                            </div>

                            <div class="border-t border-slate-700/50 pt-4">
                                <h5 class="text-white font-semibold mb-3 flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                                    </svg>
                                    Aggiungi Carico
                                </h5>
                                <div class="grid grid-cols-3 gap-2 mb-3">
                                    <input type="number" placeholder="Peso" class="glass-effect text-white p-2 text-sm rounded-lg border border-slate-600/50 focus:border-blue-500 focus:outline-none smooth-transition placeholder-gray-400" id="weight-${exercise.id}">
                                    <input type="number" placeholder="Serie" class="glass-effect text-white p-2 text-sm rounded-lg border border-slate-600/50 focus:border-blue-500 focus:outline-none smooth-transition placeholder-gray-400" id="sets-${exercise.id}">
                                    <input type="number" placeholder="Reps" class="glass-effect text-white p-2 text-sm rounded-lg border border-slate-600/50 focus:border-blue-500 focus:outline-none smooth-transition placeholder-gray-400" id="reps-${exercise.id}">
                                </div>
                                <input type="date" value="${new Date().toISOString().split('T')[0]}" class="glass-effect text-white p-2 text-sm rounded-lg border border-slate-600/50 focus:border-blue-500 focus:outline-none smooth-transition w-full mb-3" id="date-${exercise.id}">
                                
                                <button class="w-full flex items-center justify-center space-x-2 px-4 py-3 text-sm font-semibold rounded-lg smooth-transition hover-lift bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white shadow-lg" data-action="add-workout" data-exercise-id="${exercise.id}">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                    </svg>
                                    <span>Salva Carico</span>
                                </button>
                            </div>
                        `;
                        fragment.appendChild(div);
                    });

                    container.innerHTML = '';
                    container.appendChild(fragment);
                } catch (error) {
                    console.error('Error rendering exercises:', error);
                    const container = document.getElementById('exercisesGrid');
                    if (container) {
                        container.innerHTML = '<div class="col-span-full text-center text-gray-400 p-8">Errore nel caricamento degli esercizi</div>';
                    }
                }
            }

            renderProgress() {
                try {
                    if (typeof Chart !== 'undefined') {
                        requestAnimationFrame(() => {
                            this.renderProgressCharts();
                            this.populateProgressExerciseSelect();
                        });
                    } else {
                        console.warn('Chart.js not available');
                    }
                } catch (error) {
                    console.error('Progress rendering error:', error);
                }
            }

            renderProgressCharts() {
                setTimeout(() => {
                    this.renderWeightProgressChart();
                    this.renderVolumeProgressChart();
                    this.renderExerciseDetailChart();
                }, 50);
            }

            renderWeightProgressChart() {
                try {
                    const ctx = document.getElementById('weightProgressChart');
                    if (!ctx || typeof Chart === 'undefined') return;

                    if (this.charts.weightProgress) {
                        this.charts.weightProgress.destroy();
                    }

                    const exerciseMaxWeights = this.exercises.map(exercise => {
                        const exerciseWorkouts = this.workouts.filter(w => w.exerciseId === exercise.id);
                        const maxWeight = exerciseWorkouts.length > 0 ? Math.max(...exerciseWorkouts.map(w => w.weight || 0)) : 0;
                        return { name: exercise.name, weight: maxWeight };
                    }).filter(e => e.weight > 0);

                    if (exerciseMaxWeights.length === 0) {
                        ctx.parentElement.innerHTML = '<div class="text-center text-gray-400 p-8">Nessun dato disponibile</div>';
                        return;
                    }

                    this.charts.weightProgress = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: exerciseMaxWeights.map(e => e.name),
                            datasets: [{
                                label: 'Peso Massimo (kg)',
                                data: exerciseMaxWeights.map(e => e.weight),
                                backgroundColor: 'rgba(59, 130, 246, 0.8)',
                                borderColor: 'rgba(59, 130, 246, 1)',
                                borderWidth: 2,
                                borderRadius: 8,
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: {
                                duration: 750,
                                easing: 'easeOutQuart'
                            },
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: { color: '#94a3b8' },
                                    grid: { color: 'rgba(148, 163, 184, 0.1)' }
                                },
                                x: {
                                    ticks: { color: '#94a3b8', maxRotation: 45 },
                                    grid: { color: 'rgba(148, 163, 184, 0.1)' }
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.error('Weight progress chart error:', error);
                }
            }

            renderVolumeProgressChart() {
                try {
                    const ctx = document.getElementById('volumeProgressChart');
                    if (!ctx || typeof Chart === 'undefined') return;

                    if (this.charts.volumeProgress) {
                        this.charts.volumeProgress.destroy();
                    }

                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    
                    const volumeByDate = {};
                    this.workouts
                        .filter(w => new Date(w.date) >= thirtyDaysAgo)
                        .forEach(workout => {
                            const volume = (workout.weight || 0) * (workout.sets || 0) * (workout.reps || 0);
                            if (!volumeByDate[workout.date]) {
                                volumeByDate[workout.date] = 0;
                            }
                            volumeByDate[workout.date] += volume;
                        });

                    const dates = Object.keys(volumeByDate).sort();
                    const volumes = dates.map(date => volumeByDate[date]);

                    if (dates.length === 0) {
                        ctx.parentElement.innerHTML = '<div class="text-center text-gray-400 p-8">Nessun dato disponibile</div>';
                        return;
                    }

                    this.charts.volumeProgress = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: dates.map(date => this.formatDate(date)),
                            datasets: [{
                                label: 'Volume Totale (kg)',
                                data: volumes,
                                borderColor: 'rgba(139, 92, 246, 1)',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: {
                                duration: 750,
                                easing: 'easeOutQuart'
                            },
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: { color: '#94a3b8' },
                                    grid: { color: 'rgba(148, 163, 184, 0.1)' }
                                },
                                x: {
                                    ticks: { color: '#94a3b8', maxRotation: 45 },
                                    grid: { color: 'rgba(148, 163, 184, 0.1)' }
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.error('Volume progress chart error:', error);
                }
            }

            populateProgressExerciseSelect() {
                try {
                    const select = document.getElementById('progressExerciseSelect');
                    if (!select) return;
                    
                    const exercisesWithWorkouts = this.exercises.filter(e => 
                        this.workouts.some(w => w.exerciseId === e.id)
                    );

                    select.innerHTML = '<option value="">Seleziona un esercizio...</option>' +
                        exercisesWithWorkouts.map(e => 
                            `<option value="${e.id}">${e.name}</option>`
                        ).join('');
                } catch (error) {
                    console.error('Populate select error:', error);
                }
            }

            renderExerciseDetailChart() {
                const exerciseSelect = document.getElementById('progressExerciseSelect');
                const timeRangeSelect = document.getElementById('progressTimeRange');
                
                const exerciseId = exerciseSelect ? exerciseSelect.value : '';
                const timeRange = timeRangeSelect ? timeRangeSelect.value : '30';
                
                const ctx = document.getElementById('exerciseDetailChart');
                if (!ctx) return;
                
                if (!exerciseId) {
                    if (this.charts.exerciseDetail) {
                        this.charts.exerciseDetail.destroy();
                        delete this.charts.exerciseDetail;
                    }
                    ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                    return;
                }

                if (this.charts.exerciseDetail) {
                    this.charts.exerciseDetail.destroy();
                }

                let filteredWorkouts = this.workouts.filter(w => w.exerciseId == exerciseId);
                
                if (timeRange !== 'all') {
                    const daysAgo = new Date();
                    daysAgo.setDate(daysAgo.getDate() - parseInt(timeRange));
                    filteredWorkouts = filteredWorkouts.filter(w => new Date(w.date) >= daysAgo);
                }

                filteredWorkouts.sort((a, b) => new Date(a.date) - new Date(b.date));

                const exercise = this.exercises.find(e => e.id == exerciseId);

                this.charts.exerciseDetail = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: filteredWorkouts.map(w => this.formatDate(w.date)),
                        datasets: [{
                            label: 'Peso (kg)',
                            data: filteredWorkouts.map(w => w.weight),
                            borderColor: 'rgba(59, 130, 246, 1)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: 'rgba(59, 130, 246, 1)',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 750,
                            easing: 'easeOutQuart'
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: exercise ? `Progressione - ${exercise.name}` : 'Progressione Esercizio',
                                color: '#ffffff',
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: { 
                                    color: '#94a3b8',
                                    callback: function(value) {
                                        return value + 'kg';
                                    }
                                },
                                grid: { color: 'rgba(148, 163, 184, 0.1)' }
                            },
                            x: {
                                ticks: { color: '#94a3b8', maxRotation: 45 },
                                grid: { color: 'rgba(148, 163, 184, 0.1)' }
                            }
                        }
                    }
                });
            }

            renderMeasurements() {
                this.renderMeasurementsList();
                this.populateMeasurementChartTypes();
            }

            populateMeasurementChartTypes() {
                const select = document.getElementById('measurementChartType');
                if (!select) return;
                
                const types = [...new Set(this.bodyMeasurements.map(m => m.type))];
                
                const typeLabels = {
                    peso: 'Peso (kg)',
                    altezza: 'Altezza (cm)',
                    petto: 'Petto (cm)',
                    vita: 'Vita (cm)',
                    fianchi: 'Fianchi (cm)',
                    braccio_dx: 'Braccio Dx (cm)',
                    braccio_sx: 'Braccio Sx (cm)',
                    coscia_dx: 'Coscia Dx (cm)',
                    coscia_sx: 'Coscia Sx (cm)',
                    bf_percentage: 'Massa Grassa (%)'
                };

                select.innerHTML = '<option value="">Seleziona tipo di misurazione...</option>' +
                    types.map(type => 
                        `<option value="${type}">${typeLabels[type] || type}</option>`
                    ).join('');
            }

            renderMeasurementChart() {
                const measurementTypeSelect = document.getElementById('measurementChartType');
                const measurementType = measurementTypeSelect ? measurementTypeSelect.value : '';
                
                const ctx = document.getElementById('measurementChart');
                if (!ctx || !measurementType) {
                    if (this.charts.measurement) {
                        this.charts.measurement.destroy();
                        delete this.charts.measurement;
                    }
                    return;
                }

                if (this.charts.measurement) {
                    this.charts.measurement.destroy();
                }

                const measurements = this.bodyMeasurements
                    .filter(m => m.type === measurementType)
                    .sort((a, b) => new Date(a.date) - new Date(b.date));

                const typeLabels = {
                    peso: 'Peso (kg)',
                    altezza: 'Altezza (cm)',
                    petto: 'Petto (cm)',
                    vita: 'Vita (cm)',
                    fianchi: 'Fianchi (cm)',
                    braccio_dx: 'Braccio Dx (cm)',
                    braccio_sx: 'Braccio Sx (cm)',
                    coscia_dx: 'Coscia Dx (cm)',
                    coscia_sx: 'Coscia Sx (cm)',
                    bf_percentage: 'Massa Grassa (%)'
                };

                this.charts.measurement = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: measurements.map(m => this.formatDate(m.date)),
                        datasets: [{
                            label: typeLabels[measurementType],
                            data: measurements.map(m => m.value),
                            borderColor: 'rgba(139, 92, 246, 1)',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 750,
                            easing: 'easeOutQuart'
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: `Andamento - ${typeLabels[measurementType]}`,
                                color: '#ffffff',
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: measurementType !== 'peso',
                                ticks: { color: '#94a3b8' },
                                grid: { color: 'rgba(148, 163, 184, 0.1)' }
                            },
                            x: {
                                ticks: { color: '#94a3b8', maxRotation: 45 },
                                grid: { color: 'rgba(148, 163, 184, 0.1)' }
                            }
                        }
                    }
                });
            }

            renderMeasurementsList() {
                const container = document.getElementById('measurementsList');
                if (!container) return;
                
                const sortedMeasurements = this.bodyMeasurements
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 15); // Reduced for better performance

                if (sortedMeasurements.length === 0) {
                    container.innerHTML = '<p class="text-gray-400 text-center py-8">Nessuna misurazione registrata</p>';
                    return;
                }

                const typeLabels = {
                    peso: 'Peso',
                    altezza: 'Altezza', 
                    petto: 'Petto',
                    vita: 'Vita',
                    fianchi: 'Fianchi',
                    braccio_dx: 'Braccio Dx',
                    braccio_sx: 'Braccio Sx',
                    coscia_dx: 'Coscia Dx',
                    coscia_sx: 'Coscia Sx',
                    bf_percentage: 'Massa Grassa'
                };

                const fragment = document.createDocumentFragment();
                sortedMeasurements.forEach(measurement => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between p-4 glass-effect rounded-xl hover:bg-slate-700/30 smooth-transition';
                    div.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="p-2 bg-gradient-to-r from-purple-600 to-purple-700 rounded-lg">
                                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm2 2V5h1v1H5z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-white font-semibold">${typeLabels[measurement.type] || measurement.type}</h4>
                                <p class="text-gray-400 text-sm">${this.formatDate(measurement.date)}</p>
                            </div>
                        </div>
                        <div class="text-right flex items-center space-x-2">
                            <p class="text-purple-400 font-bold">${measurement.value}${measurement.type === 'peso' ? 'kg' : measurement.type === 'bf_percentage' ? '%' : 'cm'}</p>
                            <button class="p-2 text-red-400 hover:text-red-300 smooth-transition" data-action="delete" data-type="measurement" data-id="${measurement.id}">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"/>
                                    <path fill-rule="evenodd" d="M4 5a1 1 0 000 2v6a2 2 0 002 2h8a2 2 0 002-2V7a1 1 0 100-2H4z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                    `;
                    fragment.appendChild(div);
                });

                container.innerHTML = '';
                container.appendChild(fragment);
            }

            renderGoals() {
                const container = document.getElementById('goalsList');
                if (!container) return;
                
                if (this.goals.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full glass-effect rounded-2xl p-8 card-hover text-center py-12">
                            <div class="space-y-4">
                                <svg class="w-16 h-16 text-gray-400 mx-auto" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-14c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                                </svg>
                                <h3 class="text-xl font-semibold text-gray-300">Nessun obiettivo definito</h3>
                                <p class="text-gray-500">Inizia aggiungendo i tuoi primi traguardi!</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                const fragment = document.createDocumentFragment();
                this.goals.forEach(goal => {
                    const progress = this.calculateGoalProgress(goal);
                    const daysLeft = Math.ceil((new Date(goal.deadline) - new Date()) / (1000 * 60 * 60 * 24));
                    const isOverdue = daysLeft < 0;
                    const isCompleted = progress >= 100;

                    const div = document.createElement('div');
                    div.className = 'glass-effect rounded-2xl p-6 card-hover relative overflow-hidden gpu-accelerated';
                    div.innerHTML = `
                        ${isCompleted ? `
                            <div class="absolute top-4 right-4 p-2 bg-green-500/20 rounded-full">
                                <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                        ` : ''}
                        
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="p-3 bg-gradient-to-r from-yellow-600 to-yellow-700 rounded-xl shadow-lg">
                                    <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-14c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="text-white font-bold text-lg">${goal.target}</h4>
                                    <p class="text-gray-400 text-sm">
                                        ${isOverdue ? 'Scaduto' : isCompleted ? 'Completato!' : `${daysLeft} giorni rimasti`}
                                    </p>
                                </div>
                            </div>
                            <button class="p-2 text-red-400 hover:text-red-300 smooth-transition" data-action="delete" data-type="goal" data-id="${goal.id}">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"/>
                                    <path fill-rule="evenodd" d="M4 5a1 1 0 000 2v6a2 2 0 002 2h8a2 2 0 002-2V7a1 1 0 100-2H4z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>

                        <div class="space-y-3 mb-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400 text-sm">Progressi</span>
                                <span class="text-white font-semibold">${progress.toFixed(1)}%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-3">
                                <div class="${isCompleted ? 'bg-green-500' : 'progress-bar'} h-3 rounded-full" style="width: ${Math.min(progress, 100)}%"></div>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-500">Attuale: ${goal.current || 0}</span>
                                <span class="text-gray-500">Target: ${goal.value}</span>
                            </div>
                        </div>

                        <div class="text-right">
                            <p class="text-gray-400 text-sm">Scadenza: ${this.formatDate(goal.deadline)}</p>
                        </div>
                    `;
                    fragment.appendChild(div);
                });

                container.innerHTML = '';
                container.appendChild(fragment);
            }

            addExercise() {
                try {
                    const nameInput = document.getElementById('exerciseName');
                    const categorySelect = document.getElementById('exerciseCategory');
                    const muscleGroupInput = document.getElementById('exerciseMuscleGroup');

                    const name = nameInput ? nameInput.value.trim() : '';
                    const category = categorySelect ? categorySelect.value : 'petto';
                    const muscleGroup = muscleGroupInput ? muscleGroupInput.value.trim() : '';

                    if (!name || !muscleGroup) {
                        this.showNotification('Inserisci nome e gruppo muscolare', 'error');
                        return;
                    }

                    const exercise = {
                        id: Date.now(),
                        name,
                        category,
                        muscleGroup
                    };

                    this.exercises.push(exercise);
                    this.saveData();
                    
                    // Clear form
                    if (nameInput) nameInput.value = '';
                    if (muscleGroupInput) muscleGroupInput.value = '';
                    if (categorySelect) categorySelect.value = 'petto';

                    // Re-render
                    this.renderExercises();
                    if (this.currentView === 'dashboard') this.renderDashboard();
                    
                    this.showNotification('Esercizio aggiunto con successo!', 'success');
                } catch (error) {
                    console.error('Add exercise error:', error);
                    this.showNotification('Errore durante l\'aggiunta dell\'esercizio', 'error');
                }
            }

            addWorkout(exerciseId) {
                try {
                    const weightInput = document.getElementById(`weight-${exerciseId}`);
                    const setsInput = document.getElementById(`sets-${exerciseId}`);
                    const repsInput = document.getElementById(`reps-${exerciseId}`);
                    const dateInput = document.getElementById(`date-${exerciseId}`);

                    if (!weightInput || !setsInput || !repsInput || !dateInput) {
                        this.showNotification('Errore nei campi del form', 'error');
                        return;
                    }

                    const weight = parseFloat(weightInput.value);
                    const sets = parseInt(setsInput.value);
                    const reps = parseInt(repsInput.value);
                    const date = dateInput.value;

                    if (!weight || weight <= 0 || !sets || sets <= 0 || !reps || reps <= 0) {
                        this.showNotification('Inserisci valori validi per tutti i campi', 'error');
                        return;
                    }

                    const exercise = this.exercises.find(ex => ex.id === exerciseId);
                    if (!exercise) {
                        this.showNotification('Esercizio non trovato', 'error');
                        return;
                    }

                    const workout = {
                        id: Date.now(),
                        exerciseId,
                        exercise: exercise.name,
                        weight,
                        sets,
                        reps,
                        date
                    };

                    this.workouts.push(workout);
                    this.saveData();

                    // Clear inputs
                    weightInput.value = '';
                    setsInput.value = '';
                    repsInput.value = '';
                    dateInput.value = new Date().toISOString().split('T')[0];

                    // Update current values for goals
                    this.updateGoalProgress(exerciseId, weight);

                    // Re-render
                    if (this.currentView === 'exercises') this.renderExercises();
                    if (this.currentView === 'dashboard') this.renderDashboard();

                    this.showNotification('Carico aggiunto con successo!', 'success');
                } catch (error) {
                    console.error('Add workout error:', error);
                    this.showNotification('Errore durante il salvataggio del carico', 'error');
                }
            }

            addMeasurement() {
                try {
                    const typeSelect = document.getElementById('measurementType');
                    const valueInput = document.getElementById('measurementValue');
                    const dateInput = document.getElementById('measurementDate');

                    const type = typeSelect ? typeSelect.value : '';
                    const value = valueInput ? parseFloat(valueInput.value) : 0;
                    const date = dateInput ? dateInput.value : '';

                    if (!value || !date) {
                        this.showNotification('Compila tutti i campi', 'error');
                        return;
                    }

                    const measurement = {
                        id: Date.now(),
                        type,
                        value,
                        date
                    };

                    this.bodyMeasurements.push(measurement);
                    this.saveData();

                    // Clear form
                    if (valueInput) valueInput.value = '';
                    if (dateInput) dateInput.value = new Date().toISOString().split('T')[0];

                    // Update current values for body measurement goals
                    this.updateBodyMeasurementGoalProgress(type, value);

                    // Re-render
                    this.renderMeasurements();
                    if (this.currentView === 'dashboard') this.renderDashboard();

                    this.showNotification('Misurazione aggiunta con successo!', 'success');
                } catch (error) {
                    console.error('Add measurement error:', error);
                    this.showNotification('Errore durante l\'aggiunta della misurazione', 'error');
                }
            }

            addGoal() {
                try {
                    const targetInput = document.getElementById('goalTarget');
                    const typeSelect = document.getElementById('goalType');
                    const valueInput = document.getElementById('goalValue');
                    const deadlineInput = document.getElementById('goalDeadline');

                    const target = targetInput ? targetInput.value.trim() : '';
                    const type = typeSelect ? typeSelect.value : '';
                    const value = valueInput ? parseFloat(valueInput.value) : 0;
                    const deadline = deadlineInput ? deadlineInput.value : '';

                    if (!target || !value || !deadline) {
                        this.showNotification('Compila tutti i campi', 'error');
                        return;
                    }

                    const goal = {
                        id: Date.now(),
                        type,
                        target,
                        value,
                        current: 0,
                        deadline
                    };

                    this.goals.push(goal);
                    this.saveData();

                    // Clear form
                    if (targetInput) targetInput.value = '';
                    if (valueInput) valueInput.value = '';
                    if (deadlineInput) deadlineInput.value = new Date().toISOString().split('T')[0];

                    // Re-render
                    this.renderGoals();
                    if (this.currentView === 'dashboard') this.renderDashboard();

                    this.showNotification('Obiettivo aggiunto con successo!', 'success');
                } catch (error) {
                    console.error('Add goal error:', error);
                    this.showNotification('Errore durante l\'aggiunta dell\'obiettivo', 'error');
                }
            }

            updateGoalProgress(exerciseId, newWeight) {
                try {
                    const exercise = this.exercises.find(e => e.id === exerciseId);
                    if (!exercise) return;

                    this.goals.forEach(goal => {
                        try {
                            if (goal.type === 'weight' && goal.target && goal.target.toLowerCase().includes(exercise.name.toLowerCase())) {
                                goal.current = Math.max(goal.current || 0, newWeight || 0);
                            }
                        } catch (e) {
                            console.warn('Goal update error for goal:', goal.id);
                        }
                    });
                    
                    this.saveData();
                } catch (error) {
                    console.error('Update goal progress error:', error);
                }
            }

            updateBodyMeasurementGoalProgress(measurementType, newValue) {
                try {
                    this.goals.forEach(goal => {
                        try {
                            if (goal.type === 'body_weight' && measurementType === 'peso') {
                                goal.current = newValue;
                            } else if (goal.type === 'body_measurement' && goal.target && goal.target.toLowerCase().includes(measurementType)) {
                                goal.current = newValue;
                            }
                        } catch (e) {
                            console.warn('Body measurement goal update error for goal:', goal.id);
                        }
                    });
                    
                    this.saveData();
                } catch (error) {
                    console.error('Update body measurement goal progress error:', error);
                }
            }

            calculateGoalProgress(goal) {
                try {
                    if (!goal || typeof goal.current !== 'number' || typeof goal.value !== 'number') {
                        return 0;
                    }
                    
                    if (goal.type === 'body_weight') {
                        // For weight loss goals, calculate differently
                        if (goal.value < goal.current) {
                            const latestWeight = this.bodyMeasurements
                                .filter(m => m.type === 'peso')
                                .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                                
                            if (latestWeight) {
                                const totalToLose = goal.current - goal.value;
                                const lost = goal.current - latestWeight.value;
                                return Math.max(0, Math.min(100, (lost / totalToLose) * 100));
                            }
                        } else {
                            return Math.min(100, (goal.current / goal.value) * 100);
                        }
                    }
                    return Math.min(100, Math.max(0, (goal.current / goal.value) * 100));
                } catch (error) {
                    console.error('Goal progress calculation error:', error);
                    return 0;
                }
            }

            showDeleteModal(type, id) {
                this.deleteTarget = `${type}-${id}`;
                const modal = document.getElementById('deleteModal');
                if (modal) modal.classList.remove('hidden');
            }

            handleDelete(type, id) {
                try {
                    switch(type) {
                        case 'exercise':
                            this.exercises = this.exercises.filter(ex => ex.id !== id);
                            this.workouts = this.workouts.filter(w => w.exerciseId !== id);
                            break;
                        case 'workout':
                            this.workouts = this.workouts.filter(w => w.id !== id);
                            break;
                        case 'measurement':
                            this.bodyMeasurements = this.bodyMeasurements.filter(m => m.id !== id);
                            break;
                        case 'goal':
                            this.goals = this.goals.filter(g => g.id !== id);
                            break;
                    }

                    this.saveData();

                    // Re-render current view
                    switch(this.currentView) {
                        case 'dashboard':
                            this.renderDashboard();
                            break;
                        case 'exercises':
                            this.renderExercises();
                            break;
                        case 'measurements':
                            this.renderMeasurements();
                            break;
                        case 'goals':
                            this.renderGoals();
                            break;
                    }

                    this.showNotification('Elemento eliminato con successo!', 'success');
                } catch (error) {
                    console.error('Delete error:', error);
                    this.showNotification('Errore durante l\'eliminazione', 'error');
                }
            }

            exportData() {
                try {
                    const data = {
                        exercises: this.exercises,
                        workouts: this.workouts,
                        bodyMeasurements: this.bodyMeasurements,
                        goals: this.goals,
                        exportDate: new Date().toISOString(),
                        version: '2.0'
                    };
                    
                    const dataStr = JSON.stringify(data, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `fittrack-backup-${new Date().toISOString().split('T')[0]}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();

                    this.showNotification('Dati esportati con successo!', 'success');
                } catch (error) {
                    console.error('Export error:', error);
                    this.showNotification('Errore durante l\'esportazione', 'error');
                }
            }

            importData(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        // Validate data structure
                        if (!data.exercises || !data.workouts || !data.bodyMeasurements || !data.goals) {
                            throw new Error('Invalid data format');
                        }

                        // Import data
                        this.exercises = Array.isArray(data.exercises) ? data.exercises : [];
                        this.workouts = Array.isArray(data.workouts) ? data.workouts : [];
                        this.bodyMeasurements = Array.isArray(data.bodyMeasurements) ? data.bodyMeasurements : [];
                        this.goals = Array.isArray(data.goals) ? data.goals : [];

                        this.saveData();

                        // Re-render current view
                        switch(this.currentView) {
                            case 'dashboard':
                                this.renderDashboard();
                                break;
                            case 'exercises':
                                this.renderExercises();
                                break;
                            case 'progress':
                                this.renderProgress();
                                break;
                            case 'measurements':
                                this.renderMeasurements();
                                break;
                            case 'goals':
                                this.renderGoals();
                                break;
                        }

                        this.showNotification('Dati importati con successo!', 'success');
                    } catch (error) {
                        this.showNotification('Errore nell\'importazione dei dati', 'error');
                        console.error('Import error:', error);
                    }
                };
                reader.readAsText(file);

                // Reset file input
                event.target.value = '';
            }

            showNotification(message, type = 'info') {
                try {
                    // Remove existing notifications
                    const existing = document.querySelectorAll('.notification');
                    existing.forEach(n => {
                        try {
                            n.remove();
                        } catch (e) {
                            // Ignore removal errors
                        }
                    });

                    // Create notification element
                    const notification = document.createElement('div');
                    notification.className = `notification ${type}`;
                    
                    const icons = {
                        success: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>`,
                        error: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>`,
                        info: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/></svg>`
                    };

                    notification.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="flex-shrink-0">
                                ${icons[type] || icons.info}
                            </div>
                            <p class="font-medium">${message || 'Operazione completata'}</p>
                        </div>
                    `;
                    
                    document.body.appendChild(notification);
                    
                    // Show notification
                    requestAnimationFrame(() => {
                        notification.classList.add('show');
                    });
                    
                    // Hide notification
                    setTimeout(() => {
                        notification.classList.remove('show');
                        setTimeout(() => {
                            try {
                                if (notification.parentNode) {
                                    notification.parentNode.removeChild(notification);
                                }
                            } catch (e) {
                                // Ignore removal errors
                            }
                        }, 300);
                    }, 3000);
                } catch (error) {
                    console.error('Notification error:', error);
                    // Fallback to simple alert if notification fails
                    alert(message);
                }
            }

            formatDate(dateStr) {
                try {
                    if (!dateStr) return 'Data non valida';
                    const date = new Date(dateStr);
                    if (isNaN(date.getTime())) return 'Data non valida';
                    
                    return date.toLocaleDateString('it-IT', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                } catch (error) {
                    console.error('Date formatting error:', error);
                    return 'Data non valida';
                }
            }

            // Static methods for global access
            static showDeleteModal(type, id) {
                if (window.fitTrackerInstance) {
                    window.fitTrackerInstance.showDeleteModal(type, id);
                }
            }

            static addWorkout(exerciseId) {
                if (window.fitTrackerInstance) {
                    window.fitTrackerInstance.addWorkout(exerciseId);
                }
            }

            static exportData() {
                if (window.fitTrackerInstance) {
                    window.fitTrackerInstance.exportData();
                }
            }
        }

        // Global functions for backward compatibility
        function switchView(view) {
            if (window.fitTrackerInstance) {
                window.fitTrackerInstance.switchView(view);
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            try {
                window.fitTrackerInstance = new FitTracker();
                window.FitTracker = FitTracker; // Make class globally available
            } catch (error) {
                console.error('FitTracker initialization error:', error);
                // Show basic error message
                document.body.innerHTML = `
                    <div class="fixed inset-0 bg-slate-900 flex items-center justify-center">
                        <div class="text-center p-8">
                            <svg class="w-16 h-16 text-red-400 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                            </svg>
                            <h1 class="text-white text-2xl mb-2">Errore di Inizializzazione</h1>
                            <p class="text-gray-400">Ricarica la pagina per riprovare</p>
                            <button onclick="location.reload()" class="mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 smooth-transition">
                                Ricarica
                            </button>
                        </div>
                    </div>
                `;
            }
        });

        // Global error handlers
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            return true;
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            e.preventDefault();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.altKey && e.key >= '1' && e.key <= '5') {
                e.preventDefault();
                const views = ['dashboard', 'exercises', 'progress', 'measurements', 'goals'];
                const index = parseInt(e.key) - 1;
                if (views[index] && window.fitTrackerInstance) {
                    window.fitTrackerInstance.switchView(views[index]);
                }
            }
        });

        // Touch/swipe support for mobile
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });

        document.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, { passive: true });

        function handleSwipe() {
            if (!window.fitTrackerInstance) return;
            
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                const views = ['dashboard', 'exercises', 'progress', 'measurements', 'goals'];
                const currentIndex = views.indexOf(window.fitTrackerInstance.currentView);
                
                if (diff > 0 && currentIndex < views.length - 1) {
                    // Swipe left - next view
                    window.fitTrackerInstance.switchView(views[currentIndex + 1]);
                } else if (diff < 0 && currentIndex > 0) {
                    // Swipe right - previous view
                    window.fitTrackerInstance.switchView(views[currentIndex - 1]);
                }
            }
        }
    </script>
</body>
</html>
