import React, { useState, useEffect } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar, PieChart, Pie, Cell, AreaChart, Area } from 'recharts';
import { Plus, TrendingUp, Target, User, Calendar, Award, Dumbbell, Activity, Settings, Home, BarChart3, Ruler, Bell, Edit3, Trash2, Filter, ChevronRight, Star, AlertTriangle, Save, X, Check, Zap, Flame, TrendingDown } from 'lucide-react';

const FitTrackPro = () => {
  const [currentView, setCurrentView] = useState('dashboard');
  const [exercises, setExercises] = useState([]);
  const [workouts, setWorkouts] = useState([]);
  const [bodyMeasurements, setBodyMeasurements] = useState([]);
  const [goals, setGoals] = useState([]);
  const [loading, setLoading] = useState(false);
  const [editingItem, setEditingItem] = useState(null);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(null);

  // Form states
  const [newExercise, setNewExercise] = useState({ name: '', category: 'petto', muscleGroup: '' });
  const [newWorkout, setNewWorkout] = useState({ exerciseId: '', exercise: '', weight: '', sets: '', reps: '', date: new Date().toISOString().split('T')[0] });
  const [newMeasurement, setNewMeasurement] = useState({ type: 'peso', value: '', date: new Date().toISOString().split('T')[0] });
  const [newGoal, setNewGoal] = useState({ type: 'exercise', target: '', value: '', deadline: '' });

  // Animation and loading states
  const [cardAnimations, setCardAnimations] = useState({});
  
  const categories = ['petto', 'schiena', 'spalle', 'bicipiti', 'tricipiti', 'gambe', 'addominali', 'cardio'];
  const measurementTypes = ['peso', 'altezza', 'petto', 'vita', 'fianchi', 'braccio_dx', 'braccio_sx', 'coscia_dx', 'coscia_sx'];

  // Sample data initialization with loading effect
  useEffect(() => {
    if (exercises.length === 0) {
      setLoading(true);
      setTimeout(() => {
        const sampleExercises = [
          { id: 1, name: 'Panca Piana', category: 'petto', muscleGroup: 'Pettorale maggiore' },
          { id: 2, name: 'Squat', category: 'gambe', muscleGroup: 'Quadricipiti' },
          { id: 3, name: 'Deadlift', category: 'schiena', muscleGroup: 'Dorsali' },
          { id: 4, name: 'Military Press', category: 'spalle', muscleGroup: 'Deltoidi' }
        ];
        setExercises(sampleExercises);

        const sampleWorkouts = [
          { id: 1, exerciseId: 1, exercise: 'Panca Piana', weight: 80, sets: 3, reps: 8, date: '2025-08-20' },
          { id: 2, exerciseId: 1, exercise: 'Panca Piana', weight: 82, sets: 3, reps: 8, date: '2025-08-22' },
          { id: 3, exerciseId: 1, exercise: 'Panca Piana', weight: 85, sets: 3, reps: 7, date: '2025-08-25' },
          { id: 4, exerciseId: 1, exercise: 'Panca Piana', weight: 87, sets: 3, reps: 7, date: '2025-08-27' },
          { id: 5, exerciseId: 2, exercise: 'Squat', weight: 100, sets: 4, reps: 6, date: '2025-08-21' },
          { id: 6, exerciseId: 2, exercise: 'Squat', weight: 105, sets: 4, reps: 6, date: '2025-08-23' },
          { id: 7, exerciseId: 2, exercise: 'Squat', weight: 110, sets: 4, reps: 6, date: '2025-08-26' }
        ];
        setWorkouts(sampleWorkouts);

        const sampleMeasurements = [
          { id: 1, type: 'peso', value: 75, date: '2025-08-15' },
          { id: 2, type: 'peso', value: 74.5, date: '2025-08-22' },
          { id: 3, type: 'peso', value: 74, date: '2025-08-27' },
          { id: 4, type: 'petto', value: 98, date: '2025-08-15' },
          { id: 5, type: 'petto', value: 99, date: '2025-08-22' },
          { id: 6, type: 'petto', value: 100, date: '2025-08-27' }
        ];
        setBodyMeasurements(sampleMeasurements);

        const sampleGoals = [
          { id: 1, type: 'exercise', target: 'Panca Piana 100kg', value: 100, current: 87, deadline: '2025-12-31', progress: 87 },
          { id: 2, type: 'body', target: 'Peso 70kg', value: 70, current: 74, deadline: '2025-11-30', progress: 25 }
        ];
        setGoals(sampleGoals);
        setLoading(false);
      }, 800);
    }
  }, [exercises.length]);

  // Loading Component
  const LoadingSpinner = ({ size = "medium" }) => {
    const sizeClasses = {
      small: "w-4 h-4",
      medium: "w-8 h-8",
      large: "w-12 h-12"
    };

    return (
      <div className={`${sizeClasses[size]} animate-spin`}>
        <div className={`${sizeClasses[size]} border-4 border-blue-200 border-t-blue-600 rounded-full`}></div>
      </div>
    );
  };

  // Enhanced button component with loading state
  const ActionButton = ({ onClick, loading, children, variant = "primary", size = "medium", className = "", ...props }) => {
    const baseClasses = "flex items-center justify-center space-x-2 font-medium rounded-xl transition-all duration-300 transform hover:scale-105 active:scale-95";
    
    const variants = {
      primary: "bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-lg hover:shadow-blue-500/25",
      success: "bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white shadow-lg hover:shadow-green-500/25",
      warning: "bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-700 hover:to-amber-800 text-white shadow-lg hover:shadow-amber-500/25",
      danger: "bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white shadow-lg hover:shadow-red-500/25",
      secondary: "bg-gray-700 hover:bg-gray-600 text-white border border-gray-600 hover:border-gray-500"
    };

    const sizes = {
      small: "px-3 py-2 text-sm",
      medium: "px-4 py-2.5",
      large: "px-6 py-3 text-lg"
    };

    return (
      <button
        onClick={onClick}
        disabled={loading}
        className={`${baseClasses} ${variants[variant]} ${sizes[size]} ${className} ${loading ? 'opacity-50 cursor-not-allowed' : ''}`}
        {...props}
      >
        {loading ? <LoadingSpinner size="small" /> : children}
      </button>
    );
  };

  // Enhanced card component with animations
  const AnimatedCard = ({ children, className = "", delay = 0, hover = true }) => {
    return (
      <div 
        className={`bg-gray-800 rounded-2xl p-6 border border-gray-700/50 backdrop-blur-sm transition-all duration-500 ${
          hover ? 'hover:transform hover:scale-[1.02] hover:shadow-2xl hover:shadow-blue-500/10 hover:border-gray-600' : ''
        } animate-fade-in ${className}`}
        style={{ animationDelay: `${delay}ms` }}
      >
        {children}
      </div>
    );
  };

  // Smart analysis
  const analyzeProgress = () => {
    const recentWorkouts = workouts.filter(w => {
      const workoutDate = new Date(w.date);
      const twoWeeksAgo = new Date();
      twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
      return workoutDate >= twoWeeksAgo;
    });

    const progressAnalysis = exercises.map(exercise => {
      const exerciseWorkouts = recentWorkouts.filter(w => w.exerciseId === exercise.id);
      if (exerciseWorkouts.length < 2) return null;

      const sorted = exerciseWorkouts.sort((a, b) => new Date(a.date) - new Date(b.date));
      const first = sorted[0];
      const last = sorted[sorted.length - 1];
      
      const weightProgress = ((last.weight - first.weight) / first.weight) * 100;
      
      return {
        exercise: exercise.name,
        progress: weightProgress,
        trend: weightProgress > 2 ? 'excellent' : weightProgress > 0 ? 'good' : weightProgress === 0 ? 'stable' : 'declining',
        suggestion: weightProgress < 1 ? 'Considera un aumento graduale del peso o modifica il numero di ripetizioni' : 'Ottimo progresso! Continua cosÃ¬!'
      };
    }).filter(Boolean);

    return progressAnalysis;
  };

  // CRUD operations with animations
  const handleDelete = async (type, id) => {
    setLoading(true);
    setTimeout(() => {
      if (type === 'exercise') {
        setExercises(exercises.filter(ex => ex.id !== id));
        setWorkouts(workouts.filter(w => w.exerciseId !== id));
      } else if (type === 'workout') {
        setWorkouts(workouts.filter(w => w.id !== id));
      } else if (type === 'measurement') {
        setBodyMeasurements(bodyMeasurements.filter(m => m.id !== id));
      } else if (type === 'goal') {
        setGoals(goals.filter(g => g.id !== id));
      }
      setShowDeleteConfirm(null);
      setLoading(false);
    }, 300);
  };

  const handleEdit = (type, id, updatedData) => {
    if (type === 'exercise') {
      setExercises(exercises.map(ex => ex.id === id ? { ...ex, ...updatedData } : ex));
    } else if (type === 'workout') {
      setWorkouts(workouts.map(w => w.id === id ? { ...w, ...updatedData } : w));
    } else if (type === 'measurement') {
      setBodyMeasurements(bodyMeasurements.map(m => m.id === id ? { ...m, ...updatedData } : m));
    } else if (type === 'goal') {
      setGoals(goals.map(g => g.id === id ? { ...g, ...updatedData } : g));
    }
    setEditingItem(null);
  };

  // Navigation Component with enhanced styling
  const Navigation = () => (
    <div className="bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 text-white p-6 border-b border-gray-700/50 backdrop-blur-lg shadow-2xl">
      <div className="flex items-center justify-center mb-6">
        <div className="flex items-center space-x-3">
          <div className="p-3 bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl shadow-lg">
            <Dumbbell className="w-8 h-8 text-white" />
          </div>
          <div>
            <h1 className="text-3xl font-bold bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 bg-clip-text text-transparent">
              FitTrack Pro
            </h1>
            <p className="text-gray-400 text-sm">Track your fitness journey</p>
          </div>
        </div>
      </div>
      
      <div className="flex justify-center">
        <div className="flex space-x-2 bg-gray-800/50 rounded-2xl p-2 backdrop-blur-sm">
          {[
            { id: 'dashboard', icon: Home, label: 'Dashboard', color: 'blue' },
            { id: 'exercises', icon: Dumbbell, label: 'Esercizi', color: 'green' },
            { id: 'progress', icon: BarChart3, label: 'Progressi', color: 'purple' },
            { id: 'measurements', icon: Ruler, label: 'Misure', color: 'pink' },
            { id: 'goals', icon: Target, label: 'Obiettivi', color: 'amber' }
          ].map(item => (
            <button
              key={item.id}
              onClick={() => setCurrentView(item.id)}
              className={`flex items-center space-x-2 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-300 transform hover:scale-105 ${
                currentView === item.id 
                  ? `bg-gradient-to-r from-${item.color}-600 to-${item.color}-700 text-white shadow-lg shadow-${item.color}-500/25 scale-105` 
                  : 'hover:bg-gray-700/50 text-gray-300 hover:text-white'
              }`}
            >
              <item.icon className="w-5 h-5" />
              <span className="hidden sm:inline">{item.label}</span>
            </button>
          ))}
        </div>
      </div>
    </div>
  );

  // Enhanced Dashboard
  const Dashboard = () => {
    const recentWorkouts = workouts.slice(-6).reverse();
    const progressAnalysis = analyzeProgress();
    const totalWorkouts = workouts.length;
    const completedGoals = goals.filter(g => g.progress >= 100).length;
    const activeGoals = goals.length - completedGoals;

    const statsCards = [
      { title: 'Workout Totali', value: totalWorkouts, icon: Activity, color: 'blue', trend: '+12%' },
      { title: 'Obiettivi Completati', value: completedGoals, icon: Award, color: 'green', trend: '+25%' },
      { title: 'Obiettivi Attivi', value: activeGoals, icon: Target, color: 'purple', trend: 'stabile' },
      { title: 'Esercizi', value: exercises.length, icon: Dumbbell, color: 'orange', trend: '+3' }
    ];

    if (loading) {
      return (
        <div className="p-6 space-y-6">
          <div className="flex items-center justify-center h-64">
            <div className="text-center space-y-4">
              <LoadingSpinner size="large" />
              <p className="text-gray-400">Caricamento dashboard...</p>
            </div>
          </div>
        </div>
      );
    }

    return (
      <div className="p-6 space-y-8">
        <div className="text-center space-y-2">
          <h2 className="text-4xl font-bold bg-gradient-to-r from-white via-blue-100 to-white bg-clip-text text-transparent">
            Dashboard
          </h2>
          <p className="text-gray-400">Il tuo centro di controllo fitness</p>
        </div>
        
        {/* Enhanced Stats Cards */}
        <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
          {statsCards.map((stat, index) => (
            <AnimatedCard key={stat.title} delay={index * 100} className="relative overflow-hidden">
              <div className={`absolute inset-0 bg-gradient-to-r from-${stat.color}-600/10 to-${stat.color}-700/5 rounded-2xl`}></div>
              <div className="relative">
                <div className="flex items-center justify-between mb-4">
                  <div className={`p-3 bg-gradient-to-r from-${stat.color}-600 to-${stat.color}-700 rounded-xl shadow-lg`}>
                    <stat.icon className="w-6 h-6 text-white" />
                  </div>
                  <div className={`px-2 py-1 bg-${stat.color}-900/30 text-${stat.color}-400 rounded-full text-xs font-medium`}>
                    {stat.trend}
                  </div>
                </div>
                <h3 className="text-gray-400 text-sm font-medium">{stat.title}</h3>
                <p className="text-3xl font-bold text-white mt-1">{stat.value}</p>
              </div>
            </AnimatedCard>
          ))}
        </div>

        {/* Recent Activity */}
        <AnimatedCard delay={400}>
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-xl font-bold text-white flex items-center">
              <Calendar className="w-6 h-6 mr-3 text-blue-400" />
              AttivitÃ  Recente
            </h3>
            <div className="flex items-center space-x-2 text-gray-400">
              <Activity className="w-4 h-4" />
              <span className="text-sm">Ultimi 6 workout</span>
            </div>
          </div>
          
          <div className="space-y-3">
            {recentWorkouts.map((workout, index) => (
              <div key={workout.id} 
                   className="flex items-center justify-between bg-gray-700/50 p-4 rounded-xl hover:bg-gray-700 transition-all duration-300 hover:transform hover:scale-[1.01]"
                   style={{ animationDelay: `${500 + index * 100}ms` }}
              >
                <div className="flex items-center space-x-4">
                  <div className="p-2 bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg">
                    <Dumbbell className="w-5 h-5 text-white" />
                  </div>
                  <div>
                    <p className="text-white font-semibold">{workout.exercise}</p>
                    <p className="text-gray-400 text-sm">{new Date(workout.date).toLocaleDateString('it-IT')}</p>
                  </div>
                </div>
                <div className="text-right space-y-1">
                  <div className="flex items-center space-x-3">
                    <span className="text-blue-400 font-bold text-lg">{workout.weight}kg</span>
                    <span className="text-gray-300 text-sm">{workout.sets} Ã {workout.reps}</span>
                  </div>
                  <div className="text-xs text-gray-500">
                    Vol: {(workout.weight * workout.sets * workout.reps).toLocaleString()}kg
                  </div>
                </div>
              </div>
            ))}
          </div>
        </AnimatedCard>

        {/* Smart Analytics */}
        {progressAnalysis.length > 0 && (
          <AnimatedCard delay={600}>
            <div className="flex items-center justify-between mb-6">
              <h3 className="text-xl font-bold text-white flex items-center">
                <Zap className="w-6 h-6 mr-3 text-yellow-400" />
                Analisi Intelligente
              </h3>
              <div className="flex items-center space-x-2 text-gray-400">
                <Bell className="w-4 h-4" />
                <span className="text-sm">Suggerimenti automatici</span>
              </div>
            </div>
            
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
              {progressAnalysis.map((analysis, index) => (
                <div key={index} className="bg-gray-700/50 p-5 rounded-xl border border-gray-600/30">
                  <div className="flex items-center justify-between mb-3">
                    <h4 className="text-white font-semibold">{analysis.exercise}</h4>
                    <div className={`flex items-center space-x-2 px-3 py-1 rounded-full text-sm font-medium ${
                      analysis.trend === 'excellent' ? 'bg-green-900/50 text-green-400 border border-green-500/20' :
                      analysis.trend === 'good' ? 'bg-blue-900/50 text-blue-400 border border-blue-500/20' :
                      analysis.trend === 'stable' ? 'bg-yellow-900/50 text-yellow-400 border border-yellow-500/20' :
                      'bg-red-900/50 text-red-400 border border-red-500/20'
                    }`}>
                      {analysis.trend === 'excellent' && <TrendingUp className="w-4 h-4" />}
                      {analysis.trend === 'good' && <TrendingUp className="w-4 h-4" />}
                      {analysis.trend === 'stable' && <Flame className="w-4 h-4" />}
                      {analysis.trend === 'declining' && <TrendingDown className="w-4 h-4" />}
                      <span>{analysis.progress > 0 ? '+' : ''}{analysis.progress.toFixed(1)}%</span>
                    </div>
                  </div>
                  <p className="text-gray-300 text-sm leading-relaxed">{analysis.suggestion}</p>
                </div>
              ))}
            </div>
          </AnimatedCard>
        )}
      </div>
    );
  };

  // Enhanced Exercises Management
  const ExercisesView = () => {
    const [selectedCategory, setSelectedCategory] = useState('all');

    const filteredExercises = selectedCategory === 'all' 
      ? exercises 
      : exercises.filter(ex => ex.category === selectedCategory);

    return (
      <div className="p-6 space-y-8">
        <div className="text-center space-y-2">
          <h2 className="text-4xl font-bold bg-gradient-to-r from-white via-green-100 to-white bg-clip-text text-transparent">
            Gestione Esercizi
          </h2>
          <p className="text-gray-400">Organizza e monitora i tuoi esercizi</p>
        </div>
        
        {/* Add Exercise Form */}
        <AnimatedCard>
          <div className="flex items-center mb-6">
            <div className="p-3 bg-gradient-to-r from-green-600 to-green-700 rounded-xl mr-4">
              <Plus className="w-6 h-6 text-white" />
            </div>
            <h3 className="text-xl font-bold text-white">Nuovo Esercizio</h3>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <input
              type="text"
              placeholder="Nome esercizio"
              className="bg-gray-700/50 text-white p-4 rounded-xl border border-gray-600/50 focus:border-green-500 focus:outline-none focus:ring-2 focus:ring-green-500/20 transition-all"
              value={newExercise.name}
              onChange={(e) => setNewExercise({...newExercise, name: e.target.value})}
            />
            <select
              className="bg-gray-700/50 text-white p-4 rounded-xl border border-gray-600/50 focus:border-green-500 focus:outline-none focus:ring-2 focus:ring-green-500/20 transition-all"
              value={newExercise.category}
              onChange={(e) => setNewExercise({...newExercise, category: e.target.value})}
            >
              {categories.map(cat => (
                <option key={cat} value={cat}>{cat.charAt(0).toUpperCase() + cat.slice(1)}</option>
              ))}
            </select>
            <input
              type="text"
              placeholder="Gruppo muscolare"
              className="bg-gray-700/50 text-white p-4 rounded-xl border border-gray-600/50 focus:border-green-500 focus:outline-none focus:ring-2 focus:ring-green-500/20 transition-all"
              value={newExercise.muscleGroup}
              onChange={(e) => setNewExercise({...newExercise, muscleGroup: e.target.value})}
            />
          </div>
          
          <ActionButton
            onClick={async () => {
              if (newExercise.name && newExercise.muscleGroup) {
                setLoading(true);
                setTimeout(() => {
                  const exercise = {
                    id: Date.now(),
                    ...newExercise
                  };
                  setExercises([...exercises, exercise]);
                  setNewExercise({ name: '', category: 'petto', muscleGroup: '' });
                  setLoading(false);
                }, 300);
              }
            }}
            loading={loading}
            variant="success"
          >
            <Plus className="w-4 h-4" />
            <span>Aggiungi Esercizio</span>
          </ActionButton>
        </AnimatedCard>

        {/* Category Filter */}
        <AnimatedCard delay={200}>
          <div className="flex items-center space-x-4 mb-4">
            <Filter className="w-5 h-5 text-gray-400" />
            <span className="text-white font-medium">Filtra per categoria:</span>
          </div>
          <div className="flex flex-wrap gap-2">
            <button
              onClick={() => setSelectedCategory('all')}
              className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                selectedCategory === 'all'
                  ? 'bg-blue-600 text-white shadow-lg'
                  : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
              }`}
            >
              Tutti ({exercises.length})
            </button>
            {categories.map(category => {
              const count = exercises.filter(ex => ex.category === category).length;
              return (
                <button
                  key={category}
                  onClick={() => setSelectedCategory(category)}
                  className={`px-4 py-2 rounded-lg text-sm font-medium transition-all capitalize ${
                    selectedCategory === category
                      ? 'bg-blue-600 text-white shadow-lg'
                      : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                  }`}
                >
                  {category} ({count})
                </button>
              );
            })}
          </div>
        </AnimatedCard>

        {/* Exercises Grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
          {filteredExercises.map((exercise, index) => {
            const exerciseWorkouts = workouts.filter(w => w.exerciseId === exercise.id);
            const maxWeight = exerciseWorkouts.length > 0 ? Math.max(...exerciseWorkouts.map(w => w.weight)) : 0;
            const totalVolume = exerciseWorkouts.reduce((sum, w) => sum + (w.weight * w.sets * w.reps), 0);
            
            return (
              <AnimatedCard key={exercise.id} delay={index * 100}>
                <div className="relative">
                  {/* Category badge */}
                  <div className={`absolute -top-2 -right-2 px-3 py-1 rounded-full text-xs font-bold ${
                    exercise.category === 'petto' ? 'bg-red-500/20 text-red-400 border border-red-500/30' :
                    exercise.category === 'schiena' ? 'bg-blue-500/20 text-blue-400 border border-blue-500/30' :
                    exercise.category === 'gambe' ? 'bg-green-500/20 text-green-400 border border-green-500/30' :
                    exercise.category === 'spalle' ? 'bg-yellow-500/20 text-yellow-400 border border-yellow-500/30' :
                    'bg-purple-500/20 text-purple-400 border border-purple-500/30'
                  }`}>
                    {exercise.category}
                  </div>

                  <div className="flex items-center mb-4">
                    <div className="p-3 bg-gradient-to-r from-gray-600 to-gray-700 rounded-xl mr-3">
                      <Dumbbell className="w-6 h-6 text-white" />
                    </div>
                    <div className="flex-1">
                      <h4 className="text-white font-bold text-lg">{exercise.name}</h4>
                      <p className="text-gray-400 text-sm">{exercise.muscleGroup}</p>
                    </div>
                  </div>
                  
                  <div className="space-y-3 mb-4">
                    <div className="flex justify-between items-center">
                      <span className="text-gray-400 text-sm">Peso massimo</span>
                      <span className="text-blue-400 font-bold">{maxWeight}kg</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-gray-400 text-sm">Workout totali</span>
                      <span className="text-green-400 font-semibold">{exerciseWorkouts.length}</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-gray-400 text-sm">Volume totale</span>
                      <span className="text-purple-400 font-semibold">{totalVolume.toLocaleString()}kg</span>
                    </div>
                  </div>

                  {/* Add workout section */}
                  <div className="border-t border-gray-700/50 pt-4">
                    <h5 className="text-white font-medium mb-3 flex items-center">
                      <Plus className="w-4 h-4 mr-2" />
                      Aggiungi Carico
                    </h5>
                    <div className="grid grid-cols-3 gap-2 mb-3">
                      <input
                        type="number"
                        placeholder="Peso"
                        className="bg-gray-700/50 text-white p-2 rounded-lg border border-gray-600/50 focus:border-blue-500 focus:outline-none text-sm"
                        value={newWorkout.exerciseId === exercise.id ? newWorkout.weight : ''}
                        onChange={(e) => setNewWorkout({...newWorkout, exerciseId: exercise.id, exercise: exercise.name, weight: e.target.value})}
                      />
                      <input
                        type="number"
                        placeholder="Serie"
                        className="bg-gray-700/50 text-white p-2 rounded-lg border border-gray-600/50 focus:border-blue-500 focus:outline-none text-sm"
                        value={newWorkout.exerciseId === exercise.id ? newWorkout.sets : ''}
                        onChange={(e) => setNewWorkout({...newWorkout, exerciseId: exercise.id, exercise: exercise.name, sets: e.target.value})}
                      />
                      <input
                        type="number"
                        placeholder="Reps"
                        className="bg-gray-700/50 text-white p-2 rounded-lg border border-gray-600/50 focus:border-blue-500 focus:outline-none text-sm"
                        value={newWorkout.exerciseId === exercise.id ? newWorkout.reps : ''}
                        onChange={(e) => setNewWorkout({...newWorkout, exerciseId: exercise.id, exercise: exercise.name, reps: e.target.value})}
                      />
                    </div>
                    <input
                      type="date"
                      className="bg-gray-700/50 text-white p-2 rounded-lg border border-gray-600/50 focus:border-blue-500 focus:outline-none text-sm w-full mb-3"
                      value={newWorkout.exerciseId === exercise.id ? newWorkout.date : new Date().toISOString().split('T')[0]}
                      onChange={(e) => setNewWorkout({...newWorkout, exerciseId: exercise.id, exercise: exercise.name, date: e.target.value})}
                    />
                    <div className="flex space-x-2">
                      <ActionButton
                        onClick={async () => {
                          if (newWorkout.exerciseId === exercise.id && newWorkout.weight && newWorkout.sets && newWorkout.reps) {
                            setLoading(true);
                            setTimeout(() => {
                              const workout = {
                                id: Date.now(),
                                exerciseId: exercise.id,
                                exercise: exercise.name,
                                weight: parseInt(newWorkout.weight),
                                sets: parseInt(newWorkout.sets),
                                reps: parseInt(newWorkout.reps),
                                date: newWorkout.date
                              };
                              setWorkouts([...workouts, workout]);
                              setNewWorkout({ exerciseId: '', exercise: '', weight: '', sets: '', reps: '', date: new Date().toISOString().split('T')[0] });
                              setLoading(false);
                            }, 300);
                          }
                        }}
                        loading={loading}
                        variant="success"
                        size="small"
                        className="flex-1"
                      >
                        <Check className="w-3 h-3" />
                        <span>Salva</span>
                      </ActionButton>
                      
                      <ActionButton
                        onClick={() => setShowDeleteConfirm(`exercise-${exercise.id}`)}
                        variant="danger"
                        size="small"
                      >
                        <Trash2 className="w-3 h-3" />
                      </ActionButton>
                    </div>
                  </div>
                </div>
              </AnimatedCard>
            );
          })}
        </div>

        {/* Delete Confirmation Modal */}
        {showDeleteConfirm && (
          <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <AnimatedCard className="max-w-md w-full">
              <div className="text-center space-y-4">
                <div className="p-4 bg-red-500/20 rounded-full w-16 h-16 mx-auto flex items-center justify-center">
                  <AlertTriangle className="w-8 h-8 text-red-400" />
                </div>
                <h3 className="text-xl font-bold text-white">Conferma Eliminazione</h3>
                <p className="text-gray-300">Sei sicuro di voler eliminare questo elemento? Questa azione non puÃ² essere annullata.</p>
                <div className="flex space-x-3 pt-4">
                  <ActionButton
                    onClick={() => setShowDeleteConfirm(null)}
                    variant="secondary"
                    className="flex-1"
                  >
                    Annulla
                  </ActionButton>
                  <ActionButton
                    onClick={() => {
                      const [type, id] = showDeleteConfirm.split('-');
                      handleDelete(type, parseInt(id));
                    }}
                    variant="danger"
                    className="flex-1"
                  >
                    Elimina
                  </ActionButton>
                </div>
              </div>
            </AnimatedCard>
          </div>
        )}
      </div>
    );
  };

  // Enhanced Progress Charts
  const ProgressView = () => {
    const [selectedExercise, setSelectedExercise] = useState('');
    const [chartType, setChartType] = useState('weight');
    
    const getExerciseProgress = (exerciseName) => {
      return workouts
        .filter(w => w.exercise === exerciseName)
        .sort((a, b) => new Date(a.date) - new Date(b.date))
        .map(w => ({
          date: new Date(w.date).toLocaleDateString('it-IT', { month: 'short', day: 'numeric' }),
          peso: w.weight,
          volume: w.weight * w.sets * w.reps,
          oneRM: Math.round(w.weight * (1 + w.reps / 30))
        }));
    };

    const exerciseOptions = [...new Set(workouts.map(w => w.exercise))];
    const chartData = selectedExercise ? getExerciseProgress(selectedExercise) : [];

    return (
      <div className="p-6 space-y-8">
        <div className="text-center space-y-2">
          <h2 className="text-4xl font-bold bg-gradient-to-r from-white via-purple-100 to-white bg-clip-text text-transparent">
            Analisi Progressi
          </h2>
          <p className="text-gray-400">Visualizza i tuoi miglioramenti nel tempo</p>
        </div>
        
        <AnimatedCard>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div className="space-y-2">
              <label className="text-white font-medium flex items-center">
                <Filter className="w-4 h-4 mr-2" />
                Seleziona Esercizio
              </label>
              <select
                className="w-full bg-gray-700/50 text-white p-4 rounded-xl border border-gray-600/50 focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/20 transition-all"
                value={selectedExercise}
                onChange={(e) => setSelectedExercise(e.target.value)}
              >
                <option value="">Seleziona esercizio</option>
                {exerciseOptions.map(exercise => (
                  <option key={exercise} value={exercise}>{exercise}</option>
                ))}
              </select>
            </div>
            <div className="space-y-2">
              <label className="text-white font-medium flex items-center">
                <BarChart3 className="w-4 h-4 mr-2" />
                Tipo di Grafico
              </label>
              <select
                className="w-full bg-gray-700/50 text-white p-4 rounded-xl border border-gray-600/50 focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/20 transition-all"
                value={chartType}
                onChange={(e) => setChartType(e.target.value)}
              >
                <option value="weight">Progressione Peso</option>
                <option value="volume">Volume di Allenamento</option>
                <option value="oneRM">1RM Stimato</option>
              </select>
            </div>
          </div>

          {chartData.length > 0 && (
            <div className="bg-gray-800/50 p-6 rounded-2xl border border-gray-700/30">
              <h3 className="text-white font-bold text-lg mb-4 flex items-center">
                <TrendingUp className="w-5 h-5 mr-2 text-purple-400" />
                {chartType === 'weight' ? 'Progressione Peso' : 
                 chartType === 'volume' ? 'Volume di Allenamento' : '1RM Stimato'}
              </h3>
              <ResponsiveContainer width="100%" height={400}>
                {chartType === 'volume' ? (
                  <BarChart data={chartData}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                    <XAxis dataKey="date" stroke="#9CA3AF" />
                    <YAxis stroke="#9CA3AF" />
                    <Tooltip 
                      contentStyle={{ 
                        backgroundColor: '#1F2937', 
                        border: '1px solid #374151', 
                        borderRadius: '12px',
                        boxShadow: '0 10px 25px rgba(0,0,0,0.5)'
                      }}
                      labelStyle={{ color: '#F3F4F6' }}
                    />
                    <Bar dataKey="volume" fill="url(#volumeGradient)" radius={[6, 6, 0, 0]} />
                    <defs>
                      <linearGradient id="volumeGradient" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stopColor="#10B981" />
                        <stop offset="100%" stopColor="#059669" />
                      </linearGradient>
                    </defs>
                  </BarChart>
                ) : (
                  <AreaChart data={chartData}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                    <XAxis dataKey="date" stroke="#9CA3AF" />
                    <YAxis stroke="#9CA3AF" />
                    <Tooltip 
                      contentStyle={{ 
                        backgroundColor: '#1F2937', 
                        border: '1px solid #374151', 
                        borderRadius: '12px',
                        boxShadow: '0 10px 25px rgba(0,0,0,0.5)'
                      }}
                      labelStyle={{ color: '#F3F4F6' }}
                    />
                    <Area 
                      type="monotone" 
                      dataKey={chartType} 
                      stroke={chartType === 'weight' ? '#3B82F6' : '#8B5CF6'}
                      fill={`url(#${chartType}Gradient)`}
                      strokeWidth={3}
                    />
                    <defs>
                      <linearGradient id="weightGradient" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stopColor="#3B82F6" stopOpacity={0.3} />
                        <stop offset="100%" stopColor="#3B82F6" stopOpacity={0} />
                      </linearGradient>
                      <linearGradient id="oneRMGradient" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stopColor="#8B5CF6" stopOpacity={0.3} />
                        <stop offset="100%" stopColor="#8B5CF6" stopOpacity={0} />
                      </linearGradient>
                    </defs>
                  </AreaChart>
                )}
              </ResponsiveContainer>
            </div>
          )}
        </AnimatedCard>

        {/* Workout History for selected exercise */}
        {selectedExercise && (
          <AnimatedCard delay={300}>
            <h3 className="text-xl font-bold text-white mb-6 flex items-center">
              <Calendar className="w-6 h-6 mr-3 text-purple-400" />
              Storico {selectedExercise}
            </h3>
            <div className="space-y-3 max-h-96 overflow-y-auto">
              {workouts
                .filter(w => w.exercise === selectedExercise)
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .map((workout, index) => (
                  <div key={workout.id} 
                       className="flex items-center justify-between bg-gray-700/50 p-4 rounded-xl hover:bg-gray-700 transition-all duration-300 group"
                  >
                    <div className="flex items-center space-x-4">
                      <div className="p-2 bg-gradient-to-r from-purple-600 to-purple-700 rounded-lg group-hover:scale-110 transition-transform">
                        <Dumbbell className="w-5 h-5 text-white" />
                      </div>
                      <div>
                        <p className="text-white font-semibold">{new Date(workout.date).toLocaleDateString('it-IT')}</p>
                        <p className="text-gray-400 text-sm">1RM stimato: {Math.round(workout.weight * (1 + workout.reps / 30))}kg</p>
                      </div>
                    </div>
                    <div className="text-right space-y-1">
                      <div className="flex items-center space-x-4">
                        <span className="text-blue-400 font-bold text-lg">{workout.weight}kg</span>
                        <span className="text-gray-300">{workout.sets} Ã {workout.reps}</span>
                        <ActionButton
                          onClick={() => setShowDeleteConfirm(`workout-${workout.id}`)}
                          variant="danger"
                          size="small"
                        >
                          <Trash2 className="w-3 h-3" />
                        </ActionButton>
                      </div>
                      <div className="text-xs text-gray-500">
                        Vol: {(workout.weight * workout.sets * workout.reps).toLocaleString()}kg
                      </div>
                    </div>
                  </div>
                ))}
            </div>
          </AnimatedCard>
        )}

        {/* Category Overview */}
        <AnimatedCard delay={400}>
          <h3 className="text-xl font-bold text-white mb-6 flex items-center">
            <BarChart3 className="w-6 h-6 mr-3 text-purple-400" />
            Panoramica per Categoria
          </h3>
          <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            {categories.map((category, index) => {
              const categoryExercises = exercises.filter(ex => ex.category === category);
              const categoryWorkouts = workouts.filter(w => 
                categoryExercises.some(ex => ex.name === w.exercise)
              );
              const totalVolume = categoryWorkouts.reduce((sum, w) => sum + (w.weight * w.sets * w.reps), 0);
              
              return (
                <div key={category} 
                     className="bg-gray-700/50 p-6 rounded-xl border border-gray-600/30 hover:bg-gray-700 transition-all duration-300"
                     style={{ animationDelay: `${500 + index * 100}ms` }}
                >
                  <div className="flex items-center mb-4">
                    <div className={`p-3 rounded-xl mr-3 ${
                      category === 'petto' ? 'bg-red-500/20 text-red-400' :
                      category === 'schiena' ? 'bg-blue-500/20 text-blue-400' :
                      category === 'gambe' ? 'bg-green-500/20 text-green-400' :
                      category === 'spalle' ? 'bg-yellow-500/20 text-yellow-400' :
                      'bg-purple-500/20 text-purple-400'
                    }`}>
                      <Dumbbell className="w-6 h-6" />
                    </div>
                    <h4 className="text-white font-bold text-lg capitalize">{category}</h4>
                  </div>
                  
                  <div className="space-y-3">
                    <div className="flex justify-between items-center">
                      <span className="text-gray-400">Esercizi</span>
                      <span className="text-white font-semibold">{categoryExercises.length}</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-gray-400">Workout</span>
                      <span className="text-blue-400 font-semibold">{categoryWorkouts.length}</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-gray-400">Volume totale</span>
                      <span className="text-purple-400 font-bold">{totalVolume.toLocaleString()}kg</span>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        </AnimatedCard>
      </div>
    );
  };

  // Enhanced Body Measurements
  const MeasurementsView = () => {
    const [selectedMeasurement, setSelectedMeasurement] = useState('peso');
    
    const getMeasurementData = (type) => {
      return bodyMeasurements
        .filter(m => m.type === type)
        .sort((a, b) => new Date(a.date) - new Date(b.date))
        .map(m => ({
          date: new Date(m.date).toLocaleDateString('it-IT', { month: 'short', day: 'numeric' }),
          value: m.value
        }));
    };

    const chartData = getMeasurementData(selectedMeasurement);

    return (
      <div className="p-6 space-y-8">
        <div className="text-center space-y-2">
          <h2 className="text-4xl font-bold bg-gradient-to-r from-white via-pink-100 to-white bg-clip-text text-transparent">
            Misure Corporee
          </h2>
          <p className="text-gray-400">Monitora i cambiamenti del tuo corpo</p>
        </div>
        
        {/* Add Measurement */}
        <AnimatedCard>
          <div className="flex items-center mb-6">
            <div className="p-3 bg-gradient-to-r from-pink-600 to-pink-700 rounded-xl mr-4">
              <Ruler className="w-6 h-6 text-white" />
            </div>
            <h3 className="text-xl font-bold text-white">Nuova Misurazione</h3>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <select
              className="bg-gray-700/50 text-white p-4 rounded-xl border border-gray-600/50 focus:border-pink-500 focus:outline-none focus:ring-2 focus:ring-pink-500/20 transition-all"
              value={newMeasurement.type}
              onChange={(e) => setNewMeasurement({...newMeasurement, type: e.target.value})}
            >
              {measurementTypes.map(type => (
                <option key={type} value={type}>
                  {type.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                </option>
              ))}
            </select>
            <input
              type="number"
              step="0.1"
              placeholder="Valore"
              className="bg-gray-700/50 text-white p-4 rounded-xl border border-gray-600/50 focus:border-pink-500 focus:outline-none focus:ring-2 focus:ring-pink-500/20 transition-all"
              value={newMeasurement.value}
              onChange={(e) => setNewMeasurement({...newMeasurement, value: e.target.value})}
            />
            <input
              type="date"
              className="bg-gray-700/50 text-white p-4 rounded-xl border border-gray-600/50 focus:border-pink-500 focus:outline-none focus:ring-2 focus:ring-pink-500/20 transition-all"
              value={newMeasurement.date}
              onChange={(e) => setNewMeasurement({...newMeasurement, date: e.target.value})}
            />
          </div>
          
          <ActionButton
            onClick={async () => {
              if (newMeasurement.value) {
                setLoading(true);
                setTimeout(() => {
                  const measurement = {
                    id: Date.now(),
                    type: newMeasurement.type,
                    value: parseFloat(newMeasurement.value),
                    date: newMeasurement.date
                  };
                  setBodyMeasurements([...bodyMeasurements, measurement]);
                  setNewMeasurement({ type: 'peso', value: '', date: new Date().toISOString().split('T')[0] });
                  setLoading(false);
                }, 300);
              }
            }}
            loading={loading}
            variant="warning"
          >
            <Plus className="w-4 h-4" />
            <span>Aggiungi Misurazione</span>
          </ActionButton>
        </AnimatedCard>

        {/* Measurements Chart */}
        <AnimatedCard delay={200}>
          <div className="flex items-center space-x-4 mb-6">
            <Filter className="w-5 h-5 text-gray-400" />
            <select
              className="bg-gray-700/50 text-white p-3 rounded-xl border border-gray-600/50 focus:border-pink-500 focus:outline-none focus:ring-2 focus:ring-pink-500/20 transition-all"
              value={selectedMeasurement}
              onChange={(e) => setSelectedMeasurement(e.target.value)}
            >
              {measurementTypes.map(type => (
                <option key={type} value={type}>
                  {type.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                </option>
              ))}
            </select>
          </div>

          {chartData.length > 0 && (
            <div className="bg-gray-800/50 p-6 rounded-2xl border border-gray-700/30">
              <h3 className="text-white font-bold text-lg mb-4 flex items-center">
                <TrendingUp className="w-5 h-5 mr-2 text-pink-400" />
                Andamento {selectedMeasurement.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
              </h3>
              <ResponsiveContainer width="100%" height={350}>
                <AreaChart data={chartData}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                  <XAxis dataKey="date" stroke="#9CA3AF" />
                  <YAxis stroke="#9CA3AF" />
                  <Tooltip 
                    contentStyle={{ 
                      backgroundColor: '#1F2937', 
                      border: '1px solid #374151', 
                      borderRadius: '12px',
                      boxShadow: '0 10px 25px rgba(0,0,0,0.5)'
                    }}
                    labelStyle={{ color: '#F3F4F6' }}
                  />
                  <Area 
                    type="monotone" 
                    dataKey="value" 
                    stroke="#EC4899" 
                    fill="url(#measurementGradient)"
                    strokeWidth={3}
                  />
                  <defs>
                    <linearGradient id="measurementGradient" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="0%" stopColor="#EC4899" stopOpacity={0.3} />
                      <stop offset="100%" stopColor="#EC4899" stopOpacity={0} />
                    </linearGradient>
                  </defs>
                </AreaChart>
              </ResponsiveContainer>
            </div>
          )}
        </AnimatedCard>

        {/* Measurements Summary */}
        <AnimatedCard delay={300}>
          <h3 className="text-xl font-bold text-white mb-6 flex items-center">
            <User className="w-6 h-6 mr-3 text-pink-400" />
            Riepilogo Misure
          </h3>
          <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            {measurementTypes.map((type, index) => {
              const typeMeasurements = bodyMeasurements.filter(m => m.type === type);
              const sorted = typeMeasurements.sort((a, b) => new Date(b.date) - new Date(a.date));
              const latest = sorted[0];
              const previous = sorted[1];
              const change = latest && previous ? latest.value - previous.value : 0;
              
              return (
                <div key={type} 
                     className="bg-gray-700/50 p-6 rounded-xl border border-gray-600/30 hover:bg-gray-700 transition-all duration-300 group relative"
                     style={{ animationDelay: `${400 + index * 50}ms` }}
                >
                  <div className="flex items-center justify-between mb-4">
                    <h4 className="text-white font-bold">
                      {type.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                    </h4>
                    {latest && (
                      <ActionButton
                        onClick={() => setShowDeleteConfirm(`measurement-${latest.id}`)}
                        variant="danger"
                        size="small"
                        className="opacity-0 group-hover:opacity-100 transition-opacity"
                      >
                        <Trash2 className="w-3 h-3" />
                      </ActionButton>
                    )}
                  </div>
                  
                  <div className="space-y-2">
                    <div className="flex items-center justify-between">
                      <span className="text-2xl font-bold text-pink-400">
                        {latest ? `${latest.value}${type === 'peso' ? 'kg' : 'cm'}` : 'N/A'}
                      </span>
                      {change !== 0 && (
                        <div className={`flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${
                          change > 0 ? 'bg-green-900/50 text-green-400' : 'bg-red-900/50 text-red-400'
                        }`}>
                          {change > 0 ? <TrendingUp className="w-3 h-3" /> : <TrendingDown className="w-3 h-3" />}
                          <span>{change > 0 ? '+' : ''}{change.toFixed(1)}</span>
                        </div>
                      )}
                    </div>
                    <p className="text-gray-400 text-sm">
                      {latest ? `Ultimo aggiornamento: ${new Date(latest.date).toLocaleDateString('it-IT')}` : 'Nessun dato disponibile'}
                    </p>
                    <p className="text-gray-500 text-xs">
                      {typeMeasurements.length} misurazione{typeMeasurements.length !== 1 ? 'i' : 'e'} registrata{typeMeasurements.length !== 1 ? 'e' : ''}
                    </p>
                  </div>
                </div>
              );
            })}
          </div>
        </AnimatedCard>
      </div>
    );
  };

  // Enhanced Goals Management
  const GoalsView = () => (
    <div className="p-6 space-y-8">
      <div className="text-center space-y-2">
        <h2 className="text-4xl font-bold bg-gradient-to-r from-white via-amber-100 to-white bg-clip-text text-transparent">
          Obiettivi
        </h2>
        <p className="text-gray-400">Definisci e raggiungi i tuoi traguardi</p>
      </div>
      
      {/* Add Goal */}
      <AnimatedCard>
        <div className="flex items-center mb-6">
          <div className="p-3 bg-gradient-to-r from-amber-600 to-amber-700 rounded-xl mr-4">
            <Target className="w-6 h-6 text-white" />
          </div>
          <h3 className="text-xl font-bold text-white">Nuovo Obiettivo</h3>
        </div>
        
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
          <select
            className="bg-gray-700/50 text-white p-4 rounded-xl border border-gray-600/50 focus:border-amber-500 focus:outline-none focus:ring-2 focus:ring-amber-500/20 transition-all"
            value={newGoal.type}
            onChange={(e) => setNewGoal({...newGoal, type: e.target.value})}
          >
            <option value="exercise">Esercizio</option>
            <option value="body">Corpo</option>
          </select>
          <input
            type="text"
            placeholder="Descrizione obiettivo"
            className="bg-gray-700/50 text-white p-4 rounded-xl border border-gray-600/50 focus:border-amber-500 focus:outline-none focus:ring-2 focus:ring-amber-500/20 transition-all"
            value={newGoal.target}
            onChange={(e) => setNewGoal({...newGoal, target: e.target.value})}
          />
          <input
            type="number"
            placeholder="Valore target"
            className="bg-gray-700/50 text-white p-4 rounded-xl border border-gray-600/50 focus:border-amber-500 focus:outline-none focus:ring-2 focus:ring-amber-500/20 transition-all"
            value={newGoal.value}
            onChange={(e) => setNewGoal({...newGoal, value: e.target.value})}
          />
          <input
            type="date"
            className="bg-gray-700/50 text-white p-4 rounded-xl border border-gray-600/50 focus:border-amber-500 focus:outline-none focus:ring-2 focus:ring-amber-500/20 transition-all"
            value={newGoal.deadline}
            onChange={(e) => setNewGoal({...newGoal, deadline: e.target.value})}
          />
        </div>
        
        <ActionButton
          onClick={async () => {
            if (newGoal.target && newGoal.value && newGoal.deadline) {
              setLoading(true);
              setTimeout(() => {
                const goal = {
                  id: Date.now(),
                  ...newGoal,
                  value: parseFloat(newGoal.value),
                  current: 0,
                  progress: 0
                };
                setGoals([...goals, goal]);
                setNewGoal({ type: 'exercise', target: '', value: '', deadline: '' });
                setLoading(false);
              }, 300);
            }
          }}
          loading={loading}
          variant="warning"
        >
          <Target className="w-4 h-4" />
          <span>Aggiungi Obiettivo</span>
        </ActionButton>
      </AnimatedCard>

      {/* Goals List */}
      <div className="space-y-6">
        {goals.map((goal, index) => {
          const progressPercentage = goal.current > 0 ? (goal.current / goal.value) * 100 : goal.progress;
          const isCompleted = progressPercentage >= 100;
          const deadline = new Date(goal.deadline);
          const today = new Date();
          const daysLeft = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
          
          return (
            <AnimatedCard key={goal.id} delay={index * 150}>
              <div className="relative overflow-hidden">
                {isCompleted && (
                  <div className="absolute -top-2 -right-2 p-2 bg-gradient-to-r from-green-600 to-green-700 rounded-full shadow-lg">
                    <Star className="w-5 h-5 text-white" />
                  </div>
                )}
                
                <div className="flex items-center justify-between mb-6">
                  <div className="flex items-center space-x-4">
                    <div className={`p-4 rounded-xl shadow-lg ${
                      goal.type === 'exercise' 
                        ? 'bg-gradient-to-r from-blue-600 to-blue-700' 
                        : 'bg-gradient-to-r from-green-600 to-green-700'
                    }`}>
                      {goal.type === 'exercise' ? 
                        <Dumbbell className="w-6 h-6 text-white" /> : 
                        <User className="w-6 h-6 text-white" />
                      }
                    </div>
                    <div>
                      <h3 className="text-white font-bold text-xl">{goal.target}</h3>
                      <div className="flex items-center space-x-4 mt-1">
                        <p className="text-gray-400 text-sm">
                          Scadenza: {deadline.toLocaleDateString('it-IT')}
                        </p>
                        <div className={`px-3 py-1 rounded-full text-xs font-medium ${
                          daysLeft > 30 ? 'bg-green-900/50 text-green-400' :
                          daysLeft > 7 ? 'bg-yellow-900/50 text-yellow-400' :
                          daysLeft > 0 ? 'bg-orange-900/50 text-orange-400' :
                          'bg-red-900/50 text-red-400'
                        }`}>
                          {daysLeft > 0 ? `${daysLeft} giorni rimasti` : 'Scaduto'}
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div className="text-right space-y-2">
                    <div className="flex items-center space-x-3">
                      <p className="text-white font-bold text-2xl">{progressPercentage.toFixed(1)}%</p>
                      <ActionButton
                        onClick={() => setShowDeleteConfirm(`goal-${goal.id}`)}
                        variant="danger"
                        size="small"
                      >
                        <Trash2 className="w-3 h-3" />
                      </ActionButton>
                    </div>
                    <p className="text-gray-300 text-sm">{goal.current} / {goal.value}</p>
                  </div>
                </div>
                
                {/* Progress Bar */}
                <div className="relative">
                  <div className="w-full bg-gray-700 rounded-full h-4 mb-4 overflow-hidden shadow-inner">
                    <div 
                      className={`h-full rounded-full transition-all duration-1000 ease-out relative ${
                        isCompleted ? 'bg-gradient-to-r from-green-500 to-green-600 shadow-lg shadow-green-500/30' : 
                        progressPercentage > 75 ? 'bg-gradient-to-r from-yellow-500 to-orange-500 shadow-lg shadow-yellow-500/30' : 
                        'bg-gradient-to-r from-blue-500 to-purple-500 shadow-lg shadow-blue-500/30'
                      }`}
                      style={{ width: `${Math.min(progressPercentage, 100)}%` }}
                    >
                      <div className="absolute inset-0 bg-gradient-to-t from-white/10 to-transparent rounded-full"></div>
                    </div>
                  </div>
                </div>
                
                {isCompleted && (
                  <div className="flex items-center justify-center bg-gradient-to-r from-green-900/30 to-green-800/30 rounded-xl p-4 border border-green-500/30">
                    <Star className="w-5 h-5 mr-2 text-green-400" />
                    <span className="text-green-400 font-bold">ð Obiettivo completato! Complimenti! ð</span>
                  </div>
                )}
              </div>
            </AnimatedCard>
          );
        })}
      </div>
    </div>
  );

  // Main Render
  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900">
      <style jsx>{`
        @keyframes fade-in {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .animate-fade-in {
          animation: fade-in 0.6s ease-out forwards;
        }
      `}</style>
      
      <Navigation />
      <div className="max-w-7xl mx-auto">
        {currentView === 'dashboard' && <Dashboard />}
        {currentView === 'exercises' && <ExercisesView />}
        {currentView === 'progress' && <ProgressView />}
        {currentView === 'measurements' && <MeasurementsView />}
        {currentView === 'goals' && <GoalsView />}
      </div>
    </div>
  );
};

export default FitTrackPro;
